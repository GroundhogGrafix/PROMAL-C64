KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK  character, by outputting  <char>, <BS>, _  (this is the default).  Sample  escape sequences are commented  out below.  Note: Commodore 1526 &  some other C-64 printers cannot  underline at all; you might want  to use the reverse-video sequence.KKKKKKKKKKK  .nf.ce*** Important ***.nc.fi  You will have to change the following  two data statements to give the  proper underlining escape sequence  for your printer.  If unknown,   set to null (1st element=0) and  program will try to underline eachKKwill ;change it from ASCII to Commodore's; "Half-ASCII" code.PROC LITERALARG BYTE CHAR   ;Character to emitbyte s1byte s2BEGINs2=0IF C64  IF C64PUL AND $80    IF INSET(CHAR,"A-Za-z",'-')      CHAR=CHAR XOR $20 ;reverse caseIF PACK  OUT_LIN.nf.nj.rm 80.eh//DOCFOR V1.2 Notes//.oh//DOCFOR V1.2 Notes//.ce Usage: DOCFOR [-o/-e] input_file [output_file].nc.fi Reads input_file, formats text, and  writes result to output_file (defaults to name of input file with extension  of .F).  EXTRA_BLANKS=R_MRG-L_MRG-T_IND-LENGTH(LINE)+LENSTR(LINE)-LAST_CHARI=0WHILE EXTRA_BLANKS>0  WHILE (LINE+I)@< =' ' and i<lenstr(line)    I=I+1  WHILE (LINE+I)@< <>' ' and i<lenstr(line)    I=I+1  WORDS=WORDS-1  BLANKS=EXTRA_BLANKS/WORDS  EXTRA_BL ))>>1  WRITE LINEELSE  IF NOT PACK    IF JUSTIFY      JUST LINE    WRITE LINE  ELSE    PUT_WORDS LINEEND; --- End file DOCFOR1.S ---64  IF C64PUL AND $80    IF INSET(CHAR,"A-Za-z",'-')      CHAR=CHAR XOR $20 ;reverse caseIF PACK  OUT_LIN.NF       Stop filling .JU       Justify (default) .NJ       Stop justifying .CE       Center .NC       Stop centering (default) .UL       Underline .NU       Stop underlining (default) .IN [n]   Indent n (default 0), set left margin to n+1      WHILE (LINE+I)@< =' '    I=I+1  IF I<LENSTR(LINE)    START=I    WHILE (LINE+I)@< <>' ' AND I<LENSTR(LINE)      I=I+1    BLKMOV LINE+START,TEMP,I-START    TEMP[I-START]=0    IF LENGTH(OUT_LINE)+LENGTH(TEMP)>R_MRG-L_MRG-T_IND      IF JUSTIFY     t  margin to n (default=.IN) .RF [n]   Set footer  right margin to n (default=.RM) .LF [n]   Set footer  left  margin to n (default=.IN) .SH text  Set sub-heading line value (default null)             (printed after heading followed by nl)          om margin to n (default 2) .FM [n]   Set footer margin to n (default 2) .PL [n]   Set page length to n (default 66) .LS [n]   Set line spacing to n (default 1, single space) .SP [n]   Skip n lines (default 1) .OH /l/m/r/ Set odd header to text .OF CounterBEGINMOVSTR LINE,LINE+BLANKSI=0WHILE I<BLANKS  M[LINE+I]=' '  I=I+1END;Just justifies a line of text.PROC JUSTARG WORD LINE   ;Line to justifyword WORDS          ;Words in lineword EXTRA_BLANKS   ;Blanks neededword BLANKS         ;B  a literal character in the output stream.;Note: for C-64, if C64PUL (case;flip flag for printer) is set and;char is numeric equivalent of an ;alphabetic char, we must reverse the;case to "undo" the case flip performed;by the printer driver (which reak (start new line) .BP [n]   Begin page number n (default +1) .CP [n]   New page if less than n lines left (default 1) .LI  n    Emit literal character n (no default) .RH [n]   Set heading right margin to n (default=.RM) .LH [n]   Set heading lefne,nl  RETURNWORDS=0I=0WHILE I<LENSTR(LINE) ; count words in line  WHILE (LINE+I)@< =' ' AND I<LENSTR(LINE)    I=I+1  IF I<LENSTR(LINE)    WORDS=WORDS+1    WHILE (LINE+I)@< <>' ' AND I<LENSTR(LINE)      I=I+1    LAST_CHAR=IIF WORDS<2  RETURNE[OUT_PTR]=CHAR  OUT_PTR=OUT_PTR+1  OUT_LINE[OUT_PTR]=0ELSE  s1=char  PUTOUTFILE #s1 END;Text processes one line of text.PROC TEXTARG WORD LINE   ;Line of textBEGINIF UNDERLINE  UNDRLINE LINEIF CENTER  T_IND=T_IND+(R_MRG-L_MRG-LENGTH(LINEFormatting commands may be embedded in the text on a line  beginning with a period. Use "#" to denote the page number in the text.  Upper or lower case may be used for commands. The following commands are available:.nf .FI       Fill (default) ANKS=EXTRA_BLANKS-BLANKS  ADD_BLANKS LINE+I,BLANKSEND;Put_words copies the words from a buffer to a filled output line.PROC PUT_WORDSARG WORD LINE   ;Line of textWORD I      ;CounterWORD START  ;Word start indexBEGINI=0WHILE I<LENSTR(LINE)   .nf.ce*** Important ***.nc.fi  You will have to change the following  two data statements to give the  proper underlining escape sequence  for your printer.  If unknown,   set to null (1st element=0) and  program will try to underline each      (Note .RM must be larger than .IN) .TI [n]   Indent an additional n on next line (default 5) .RM [n]   Set right margin to n (default 80) .TM [n]   Set top margin to n (default 2) .HM [n]   Set header margin to n (default 2) .BM [n]   Set bott	   JUST OUT_LINE      BRK    MOVSTR TEMP,OUT_LINE+OUT_PTR    OUT_PTR=OUT_PTR+I-START+1    OUT_LINE[OUT_PTR-1]=' '    IF INSET(OUT_LINE[OUT_PTR-2],".?!")      OUT_LINE[OUT_PTR]=' '      OUT_PTR=OUT_PTR+1    OUT_LINE[OUT_PTR]=0END;Literal places   (printed as is, no margins, nf, nj) .PN [n]   Initialize the page number (default 1) .AD file  Add a file to the existing file, like include in PROMAL             (cannot have .ad within a .ad file) blank lines generate .BP and .SP 1 automatically
/l/m/r/ Set odd footer to text .EH /l/m/r/ Set even header to text .EF /l/m/r/ Set even footer to text     /l/m/r/ means first char is delimiter of left, middle, and right text             \xxx where xxx is decimal byte to insert in text .BR       Blanks to insertword LAST_CHAR      ;Last non-blank character indexWORD I              ;Counterword holdBEGINhold=r_mrg-l_mrg-t_indIF (not pack) and (lenstr(line) >= hold)  output "Line too big to justify, L=#w >= M=#w#c",lenstr(line),hold  put li; --- Include file DOCFOR1.S for DOCFOR ---CON BS=8  ;ASCII code for backspaceproc putoutfilearg word linebeginif this_page < start_page  returnif page_side=0  PUTF OUTFILE,line  returnif this_page%2=1 and page_side=1  PUTF OUTFILE,lineelse else if (string+j)@< ='\'    j=j+1    j=j+strval(string+j,#hold,10,3)-1    m[part+i]=hold:<    i=i+1  ELSE    M[PART+I]=(STRING+J)@<    I=I+1  J=J+1M[PART+I]=0END;Title outputs a title (header or footer)PROC TITLEARG WORD STRING   ;Title N"Bh  @& jH(( :(~$(*8,($ :(~$(*"hH,:&'"(:&':&'00&7DOCUMENT COMPLETED. RF$ U0 3 b n       3DfbeuHxd	nts a given number of spaces.PROC INDENTARG word SPACES   ;Spaces to indentWORD I  ;Loop counterBEGINI=0WHILE I<SPACES  PUTOUTFILE " "  I=I+1END;Undrline underlines a line.PROC UNDRLINEARG WORD LINE   ;Line to underlineWORD I      ;CounteDENT (R_MRG-L_MRG-LENSTR(WORK))>>1+L_MRG-COLUMN  PUTOUTFILE WORK  COLUMN=(R_MRG-L_MRG-LENSTR(WORK))>>1+L_MRG+LENSTR(WORK)  GET_TITLE STRING,WORK,3  INDENT R_MRG-LENSTR(WORK)-COLUMN  PUTOUTFILE WORKSKIP 1END;Do_header prints a page header.PROC  4tDx  #jH(( :(~$(*8,($ :(~$(*"hH,:&'"(:&':&'00&7DOCUMENT COMPLETED. RF$ U0 3 b n       3DfbeuHxd	erline esc seq  MOVSTR WORK,LINEELSE  J=0  FOR I=0 TO LENSTR(LINE)-1    IF (LINE+I)@< <>' '      WORK[J+2]=(LINE+I)@<      WORK[J+1]=BS      WORK[J]='_'      J=J+3    ELSE      WORK[J]=' '      J=J+1  WORK[J]=0  MOVSTR WORK,LINEEND;Get_tsub_header  putoutfile "\0d"  putoutfile "\0d"  curr_line=curr_line+2END;Do_footer prints a page footer.PROC DO_FOOTERBEGINSKIP B_MRGIF THIS_PAGE%2=1  TITLE ODD_FOOTER,lf_mrg,rf_mrgELSE  TITLE EVEN_FOOTER,lf_mrg,rf_mrgSKIP F_MRGEND;Writ PG_LN-B_MRG-F_MRG-1-CURR_LINE  DO_FOOTERCURR_LINE=0END;Space skips a given number of lines.PROC SPACEARG INT LINES   ;Lines to skipBEGINBRKIF CURR_LINE<PG_LN-B_MRG-F_MRG-1  IF CURR_LINE=0    DO_HEADER  IF LINES<PG_LN-B_MRG-F_MRG-1-CURR_LIN holdBEGINm[PART]=0IF LENSTR(STRING)=0  RETURNDELIM=STRING@<I=1J=1WHILE I<PART_NO  J=J+INSET(DELIM,STRING+J)  I=I+1K=J+INSET(DELIM,STRING+J)-1I=0WHILE J<K AND I<BIG_SZ-1  IF (STRING+J)@< ='#'    INTSTR THIS_PAGE,PART+I    I=LENSTR(PART) MRG-F_MRG-2  DO_FOOTEREND;Brk prints the current fill line.PROC BRKBEGINIF OUT_PTR>0  WRITE OUT_LINE  OUT_PTR=0  OUT_LINE[0]=0END;Page begins a new page of output.PROC PAGEBEGINBRKIF CURR_LINE>0 AND CURR_LINE<PG_LN-B_MRG-F_MRG-1  SKIPLI, won't work right.FUNC WORD LENGTHARG WORD LINE   ;Line to compute length ofWORD I    ;CounterWORD LEN  ;Length of lineBEGINLEN=0I=0WHILE I<LENSTR(LINE)  IF (LINE+I)@< = ESC    I=I+1  ELSE IF (LINE+I)@< =BS    LEN=LEN-1  ELSE IF (LINE+I) if this_page%2=0 and page_side=2  PUTF OUTFILE,lineend;Skip skips a given number of lines.PROC SKIPARG WORD LINES  ;Lines to skipWORD I  ;Loop counterBEGINI=0WHILE I<LINES  PUTOUTFILE "\0d"  I=I+1CURR_LINE=CURR_LINE+LINESEND;Indent indeto printarg int l_mrgarg int r_mrgBYTE COLUMN   ;Current columnWORD I        ;Loop counterBEGINIF LENSTR(STRING)>0  INDENT L_MRG  COLUMN=L_MRG  GET_TITLE STRING,WORK,1  PUTOUTFILE WORK  COLUMN=COLUMN+LENSTR(WORK)  GET_TITLE STRING,WORK,2  IN)E"%(+.147:=@CFILORUX[^ad	gjmpsvy7L   ] 5 
       rWORD J      ;CounterBEGINIF BEG_UNDER[0]<>0 ; Begin-underline esc sequence defined?  MOVSTR BEG_UNDER,WORK ; Embed it in WORK  J=LENSTR(WORK)   MOVSTR LINE, WORK+J ; followed by text  J=LENSTR(WORK)  MOVSTR END_UNDER,WORK+J ; followed by end-undDO_HEADERBEGINCURR_LINE=0THIS_PAGE=NEXT_PAGEoutput "Processing page #i#c",this_pageNEXT_PAGE=NEXT_PAGE+1SKIP H_MRGIF THIS_PAGE%2=1  TITLE ODD_HEADER,lh_mrg,rh_mrgELSE  TITLE EVEN_HEADER,lh_mrg,rh_mrgSKIP T_MRGif sub_header[0]<>0  putoutfile @< =CR    LEN=0  ELSE IF (LINE+I)@< >=' ' AND (LINE+I)@< <='~'    LEN=LEN+1  I=I+1RETURN LENEND;Add_blanks inserts blanks at the start of a line.PROC ADD_BLANKSARG WORD LINE       ;Line to expandARG word BLANKS     ;Blanks to insertWORD I  ;	itle returns a part of a header or footer.PROC GET_TITLEARG WORD STRING   ;TitleARG WORD PART     ;Buffer for part of titleARG WORD PART_NO  ;Part numberBYTE DELIM  ;Part delimiterWORD I      ;CounterWORD J      ;CounterWORD K      ;Counterword
e outputs a line of text.PROC WRITEARG WORD LINE   ;Line to printWORD IBEGINIF CURR_LINE=0 OR CURR_LINE>PG_LN-B_MRG-F_MRG-2  DO_HEADERINDENT L_MRG+T_INDT_IND=0PUTOUTFILE LINESKIP MIN(SPACING,PG_LN-B_MRG-F_MRG-1-CURR_LINE)IF CURR_LINE>PG_LN-B_E    SKIP LINES  ELSE    SKIP PG_LN-B_MRG-F_MRG-1-CURR_LINE  IF CURR_LINE>PG_LN-B_MRG-F_MRG-2    DO_FOOTEREND;Length computes the print length of a line.;Ignores <ESC> and 1 character after it in;count.  Of you embed other control chars;with .    7"	 7WDOCFOR        " C D F jPQjrQ0$* &<BRj&-$ BjPQjQBR6&N@h$m BR&9:&WBjPQjQ" hJBRj&-$ 00&jHBjPQjQ" BRj&-$ 00 (Y@ &6NB l(BB &6jB@( (YBB &6jB &6NB 0(B &6@( (Yj(F  hJ3:/J-:-&W:/jJ/: (:-lj$"::(""::(:(h
"h$"(Y(Y(Y:3lJ3Processing 0P
BB
0-&fB
B&6t$B
jP
"BB
0 B
B&6t$B
jP
"B
B&6$*Bh  "BB
PB>&N	@	B&6r$QB0  "B(|PB0+*iBj  "0-*wBl  "B0  B0$BB  BjB  "BB  BjB  A-Za-z0-9 F  &6&3"
0. &fN@0lr$
@0F  0W&$J:h$Q0$? &rh$? 0W&$J:h$Q &<#CUsage: DOCFOR [-p #] [-o/-e] inputfile [outputfile] = -p ERROR: invalid page number (#s) #cStarting with page #i...#c = -o Formattiv$	:3h$(XB:&:":$j:3v$B("
	:&:":$j:3(:3:&:":$l$	(FhPhPBB&6t$	BB0$M	BjP"	BB0$c	BjP"	BB0$v	hP"	BB0 BB0~z$	BjPBjP"*	BFBBB&3hPBBt$	BB0   BjP0*@h$jH
(i"0*@h$hH
"0*@h$jH"0*@h$	hH"0*7@0z$4:B@h::jh(J(i"0*_@0z$\:B@h::jh(J"0*@0z$:B@h::jh(J"0	*@0z$:B@2'::j0(J(i"0
*@0H
hHhHhJhJ0PJ:J:J:J:JlJlJ lJ"lJ$0BJ&jJ(hJ*hh"hh"hh"hh"hh"hJ-jJ/hJ1hJ3hJ hh hH,hHF :-:v$e8h$u:B&:-lj8j$:B&":-lh8l$:B&FhPBBt$(YBjP":3BJ3 F
BB0 BB&6t$
BjP"
BjPBBPBBPBBB(	"
:Line too big to justify, L=#w >= M=#w#c FhPBB&6t$%BB0 $dBjP"NBB&6t$"BPBB0 BB&6t$BjP"uBB BB&0BBh  (	 (	:::$J""0*@0z$:$B@h:&:: :"0l(J$"0*#@0z$ :&B@:: :":$02'0B(J&"0*F@0z$C:(B@j2'j(J("0*n@0z$k:*B@h2'j(J*:*("0*@0$B"&3"0*@0$B"&3"0*@0$B"&3"0
BBt$B
@BB
&fP
BjP"B
@BB
&fjPhPB
BtB2 jt$BB
0#$G:-BB&B&6P"BB
0\$B
jP
B
BB
>0
0&jP
BBB  BjP"BBBB
  BjPB
jP
"BBh  FB&6h$RB(BNB j(("B(:|  FI NF JU NJ CE NC UL NU IN TI RM TM HM BM FM PL LS SP OH OF EH EF BR BP CP LI RH LH RF LF SH PN AD F Bhv$B"BF	Bj50!jl&TPBj$B0!  "BB "0*@0$B(-"Can't have .AD within .AD file F hP  B  h$'  B  0 $hBjP"jF  ($V  &3  (a  &3  (a"ph
  0.$j  (a"p  (~.br .sp 1 FhPB>&N@@0B0t$B@  BjPB>&&lHBjPQjQQjrQl$
&<BR 0&3BjP &6jQj$9&< &6j$x0. &fN@ &600r$x  &6&3 0R&$J:h$ &<Ql$BR &3 &6j$0. &fN@ &600r$  page #i#c   F  :"(:-lj$"::("	"::(:$(F:3h:3:&:":$l$,(X::(hJB(Y:(:&:":$j:3&(:3:&:":$l$h(F  : h$ (hJ hh F  (i:3h:3:&:":$jv$:&:":$j:3((hJ3F (i:3:&:":$j@h*BP"0*BP"j*BBP"l*BBP"BBv$:5?BB&WBPBB	$0:5?BB	&WB	PBa#CERROR: .#s #I < #I #CERROR: .#s #I > #I FB>>>(@J5@h*@h$jH"j*@h$hH(i"l*@h$jH	"0*@h$hH	(i"ng ODD pages only. = -e Formatting EVEN pages only. #CUsage: DOCFOR [-p #] [-o/-e] inputfile [outputfile] #CCan't write to same device. .T #CCan't open #S .F #CCan't open #S F  8,$h0R&$J:h$&WhH,hj#CCan't open #S#c F  jHjH	h"	F:::P8B&6B$
B&6B&WB0&hPhPBB&6t$z
BB0 BB&6t$>
BjP"
BB&6t$w
BjPBB0 BB&6t$s
BjP"R
BP	"
Blt$
:::B(	B&6B	PhPBh$BB0 BB&6t$
BjP"z$:B@::j2'0P(J(i"0*@0z$	:B@::j2'0P(J"0*6@0z$3:B@::j2'0P(J"0*e@0z$b:B@h:&: :$:"0l(J"0*@0z$: B@h:&::$:"0l(J "0*@0z$:"B@h:&:: :$0l(	hPBBt$(YBjP"  Fh= h$J5  &3 &6PB B&3 &6P5
  B&3 B&3"hP>hPB&6jnBB0 $BlBB Bj0 B0_ B0P"B0  BjPBh  B&3F	Bh  B&6h$BNjPjP
8	$ (	(i  : &3: BBjJ : j0  : l
 &f$: 0  : jJ : h "A-.?! FhN8$X0$X@0-&f$X@0 N8$t: @ : jJ : h "}@N>(YA-Za-z F 8$B(8
$:::B(	jJB("8$8	$B(	B*@0$B"&3"0*@0$B"&3"0 *@0$8,$00&"B&3jH,"0*.@h$+(i"0*[@0z$X(:-B@h2':-j(J-:-J/"0*@0z$:-B@h2'j(J-:-J/"0*@0z$:1B@h2'j(J1:1:&:$:"j:3$(A                         PROMAL-DOCFORPD2A                                                                                       DOCFOR.C             DOCFOR.S         %    DOCFOR1.S            DOCFOR2.S            DOCFOR_NOTES.T                                                                                                          KKKKKKKKKKKKKKKKKPROGRAM DOCFOR  ; DOCFOR - Document Formatter 1.2; by David Long    Last edit 2/7/86 (BDC);                  Last edit 3/3/87 Craig McDowell;                  Last edit 6/02/87 Craig McDowell;Usage: DOCFOR [-p #] [-o/-e] input_file [output_file] middle, and right text;            \xxx where xxx is decimal byte to insert in text;.BR       Break (start new line);.BP [n]   Begin page number n (default +1);.CP [n]   New page if less than n lines left (default 1);.LI  n    Emit literal characte LIBRARYEXT ASM FUNC WORD GETVER AT $0F99 ; Get versionEXT BYTE C64PUL AT $DF4  ; C-64 only, case flip for printerEXT BYTE C64DYNO AT $DE3 ; C-64 only, dynodisk flagCON BUFF_SZ=255   ;Buffer lengthCON BIG_SZ=256    ;Large buffer sizeCON NAME_LEN=on;both sides of the paper.;The -p # allows printing to start;from a specific page number.;Formatting commands may;be embedded in the text on a line ;beginning with a period.;Use "#" to denote the page number in;the text.  Upper or lower case mayb-heading line value (default null);            (printed after heading followed by a blank line);            (line printed as is, no margins, nf, nj);.PN [n]   Initialize page number with page break (default 1);.AD file  Add a file to existing file,   ;Bottom margin defaultCON F_MRG_DEF=2     ;Footer margin defaultCON PG_LN_DEF=66    ;Page length defaultCON SPACING_DEF=1   ;Line spacing default (single)BYTE LINE[BIG_SZ]   ;Line bufferBYTE WORK[BIG_SZ]   ;Work bufferBYTE TEMP[BIG_SZ]   ;Temp w  Stop underlining (default);.IN [n]   Indent n (default 0), set left margin to n+1;           (Set .RM before .IN if .IN > current .RM);.TI [n]   Indent an additional n on next line (default 5);.RM [n]   Set right margin to n (default 80);.TM [n]  erline each; character, by outputting; <char>, <BS>, _; (this is the default).  Sample; escape sequences are commented; out below.  Note: Commodore 1526 &; some other C-64 printers cannot; underline at all; you might want; to use the reverse-vide .adWORD OUTFILE        ;Output file handleBYTE PACK           ;Flag (TRUE means filling text)BYTE JUSTIFY        ;Flag (TRUE means justifying text)BYTE CENTER         ;Flag (TRUE means centering text)BYTE UNDERLINE      ;Flag (TRUE means underlininult 1, single space);.SP [n]   Skip n lines (default 1);.OH /l/m/r/ Set odd header to text;.OF /l/m/r/ Set odd footer to text;.EH /l/m/r/ Set even header to text;.EF /l/m/r/ Set even footer to text;    /l/m/r/ means first char is delimiter of left,C,'Y',0; --- OKIDATA 20, 92 & 93 (no Print & Play) ---DATA BYTE BEG_UNDER []=   ESC,'C',0DATA BYTE END_UNDER []=  ESC,'D',0;---Commodore 1526 Reverse Video substitute---;DATA BYTE BEG_UNDER []= ;  18,0;DATA BYTE END_UNDER []=;  146,0INCLUDE;Reads input_file, formats text, and ;writes result to output_file (defaults;to name of input file with extension ;of .F).  The -o argument specifies;output only odd pages.  The -e;argument specifies output only even;pages.  This allows formatting r n (no default);.RH [n]   Set heading right margin to n (default=.RM);.LH [n]   Set heading left  margin to n (default=.IN);.RF [n]   Set footer  right margin to n (default=.RM);.LF [n]   Set footer  left  margin to n (default=.IN);.SH text  Set su16   ;File name lengthCON L_MRG_DEF=0     ;Left margin defaultCON T_IND_DEF=5     ;Temporary indent defaultCON R_MRG_DEF=80    ;Right margin defaultCON T_MRG_DEF=2     ;Top margin defaultCON H_MRG_DEF=2     ;Header margin defaultCON B_MRG_DEF=2   ;be used for commands.;The following commands are available:;.FI       Fill (default);.NF       Stop filling;.JU       Justify (default);.NJ       Stop justifying;.CE       Center;.NC       Stop centering (default);.UL       Underline;.NU     similar to include in PROMAL;*** Important ***; You will have to change the following; two data statements to give the; proper underlining escape sequence; for your printer.  If unknown, ; set to null (1st element=0) and; program will try to undork bufferBYTE OUT_LINE[BIG_SZ]    ;Filled lineBYTE FILE_NAME[NAME_LEN+1] ;File nameBYTE add_file[NAME_LEN+1]  ;File name for .adWORD OUT_PTR        ;Filled line indexWORD INFILE         ;Input file handleWORD INFILE2        ;Input file handle for 	 Set top margin to n (default 2);.HM [n]   Set header margin to n (default 2);.BM [n]   Set bottom margin to n (default 2);.FM [n]   Set footer margin to n (default 2);.PL [n]   Set page length to n (default 66);.LS [n]   Set line spacing to n (defa
o sequence. ;DATA BYTE BEG_UNDER []= ; Begin Underline seq, 0-terminated;0  ; Not defined, do by backspace & _;DATA BYTE END_UNDER []= ;0CON ESC = 27;--- APPLE IMAGEWRITER ---; DATA BYTE BEG_UNDER []= ; ESC,'X',0; DATA BYTE END_UNDER []=; ESg text)BYTE C64            ;Flag (TRUE means is Commodore 64 )byte page_side      ;0=output both odd & even pages                    ;1=output odd pages only                    ;2=output even pages onlyint start_page      ;begin output page numberIg EVEN pages only.",nl  page_side=2  i=i+1  ncarg=ncarg-1IF NCARG<1 OR NCARG>2  ABORT "#CUsage: DOCFOR [-p #] [-o/-e] inputfile [outputfile]"MOVSTR CARG[i],FILE_NAME,NAME_LENi=i+1IF LENSTR(FILE_NAME)=1 AND NCARG=1  ABORT "#CCan't write to same d>0  if m[line+i]<>' '    return 0 ; not a null line  i=i+1return 1 ; is a null lineendproc processline; perform functions on the input linebeginif nulline  movstr ".br",line  command(line)  movstr ".sp 1",line  command(line)else  IF LINE[G           ;Top marginINT H_MRG           ;Header marginINT B_MRG           ;Bottom marginINT F_MRG           ;Footer marginINT PG_LN           ;Page lengthINT SPACING         ;Line spacingINT LINES           ;Lines to skipbyte addflag        ;Ad,FILE_NAME  IF LENSTR(FILE_NAME)>1    INDEX=INSET('.',FILE_NAME)    IF NOT INDEX AND LENSTR(FILE_NAME)<NAME_LEN-3      MOVSTR ".F",FILE_NAME+LENSTR(FILE_NAME)ELSE  INDEX=INSET('.',FILE_NAME)  IF INDEX<NAME_LEN-2    FILE_NAME[INDEX]='F'OUTFILE=OP noteofend;Main routineBEGINC64=GETVER:> = $01 ; Set flag if is CommodoreINITOPEN_FILESWHILE GETLine(INFILE)  processline  if addflag and open_add_file    WHILE GETLine(INFILE2)      processline     addflag=false    close infile2PAGECLOrent page numberINT NEXT_PAGE       ;Next page numberINT COND_PAGE       ;Conditional page valueINT CURR_LINE       ;Current line number;Open_files opens the input and output files.PROC OPEN_FILESBYTE INDEX  ;Index into file nameword iBEGINi=1dd_file,'R')IF INFILE2=0  output "#CCan't open #S#c",add_file  addflag=false  return falsereturn trueEND;Init performs miscellaneous initialization.PROC INITBEGINPACK=TRUEJUSTIFY=TRUECENTER=FALSEUNDERLINE=FALSEC64=FALSEL_MRG=L_MRG_DEFT_ ; --- Include file DOCFOR2.S for DOCFOR ---;Command numbersCON FI=0    ;FillCON NF=1    ;No fillCON JU=2    ;JustifyCON NJ=3    ;No justifyCON CE=4    ;CenterCON NC=5    ;No centerCON UL=6    ;UnderlineCON NU=7    ;No underlineCON IN=8    ;In#cStarting with page #i...#c",start_page  i=i+1  ncarg=ncarg-1else  start_page=0if cmpstr(carg[i],"=","-o",true)  put nl,"Formatting ODD pages only.",nl  page_side=1  i=i+1  ncarg=ncarg-1else if cmpstr(carg[i],"=","-e",true)  put nl,"Formattinader[0]=0THIS_PAGE=0NEXT_PAGE=1COND_PAGE=0CURR_LINE=0OUT_PTR=0OUT_LINE[0]=0addflag=falsepage_side=0ENDINCLUDE DOCFOR1 ;Text processing routines.INCLUDE DOCFOR2  ;Command processing routinesfunc byte nullineword ibegini=0while m[line+i]<NT L_MRG           ;Left marginINT T_IND           ;Temporary indent valueINT R_MRG           ;Right marginINT RH_MRG          ;Right marginINT LH_MRG          ;Left  marginINT RF_MRG          ;Right marginINT LF_MRG          ;Left  marginINT T_MRevice."IF LENSTR(FILE_NAME)>1  INDEX=INSET('.',FILE_NAME)  IF NOT INDEX AND LENSTR(FILE_NAME)<NAME_LEN-3    MOVSTR ".T",FILE_NAME+LENSTR(FILE_NAME)INFILE=OPEN(FILE_NAME,'R')IF INFILE=0  ABORT "#CCan't open #S",FILE_NAMEIF NCARG=2  MOVSTR CARG[i]0]='.'    COMMAND(LINE)  ELSE    TEXT(LINE)endfunc byte getlinearg word fileword ibyte noteofbyte holdbegini=0noteof=getcf(file,#hold)while noteof and hold<>cr and i<buff_sz  line[i]=hold  i=i+1  noteof=getcf(file,#hold)line[i]=0returnd file flagBYTE ODD_HEADER[BIG_SZ]    ;Odd page headerBYTE ODD_FOOTER[BIG_SZ]    ;Odd page footerBYTE EVEN_HEADER[BIG_SZ]   ;Even page headerBYTE EVEN_FOOTER[BIG_SZ]   ;Even page footerbyte sub_header[big_sz]    ;Sub-headingINT THIS_PAGE       ;CurEN(FILE_NAME,'W')IF OUTFILE=0  IF IOERROR=5  ;File exists    IF ZAPFILE(FILE_NAME)=0      OUTFILE=OPEN(FILE_NAME,'W')  IF OUTFILE=0    ABORT "#CCan't open #S",FILE_NAMEENDfunc byte OPEN_add_fileBEGINif not addflag  return falseINFILE2=OPEN(a =SE INFILECLOSE OUTFILEPUT CR,"DOCUMENT COMPLETED.",CRENDe getlinearg word fileword ibyte noteofbyte holdbegini=0noteof=getcf(file,#hold)while noteof and hold<>cr and i<buff_sz  line[i]=hold  i=i+1  noteof=getcf(file,#hold)line[i]=0return	IF NCARG<1 OR NCARG>4  ABORT "#CUsage: DOCFOR [-p #] [-o/-e] inputfile [outputfile]"if cmpstr(carg[i],"=","-p",true)  i=i+1  ncarg=ncarg-1  index=strval(carg[i],#start_page)  if index=0    exit "ERROR: invalid page number (#s)",carg[i]  output "
IND=0R_MRG=R_MRG_DEFLH_MRG=L_MRGRH_MRG=R_MRGLF_MRG=L_MRGRF_MRG=R_MRGT_MRG=T_MRG_DEFH_MRG=H_MRG_DEFB_MRG=B_MRG_DEFF_MRG=F_MRG_DEFPG_LN=PG_LN_DEFSPACING=SPACING_DEFLINES=0ODD_HEADER[0]=0ODD_FOOTER[0]=0EVEN_HEADER[0]=0EVEN_FOOTER[0]=0sub_hedentCON TI=9    ;Temporary indentCON RM=10   ;Right marginCON TM=11   ;Top marginCON HM=12   ;Header marginCON BM=13   ;Bottom marginCON FM=14   ;Footer marginCON PL=15   ;Page lengthCON LS=16   ;Line spacingCON SP=17   ;Skip linesCON OH=18   ;P)@<,"A-Za-z0-9",'-') AND LOOP<LENSTR(LINE)    LOOP=LOOP+1  WHILE (LINE+LOOP)@< =' ' AND LOOP<LENSTR(LINE)    LOOP=LOOP+1  IF LOOP=LENSTR(LINE)    M[ARGUMENT]=NONE  ELSE    ARGUMNT=LINE+LOOP    INDEX=STRVAL(ARGUMNT,#VAL)    IF INDEX<LENSTR(ARGUMARAM(L_MRG,VALUE,ARGUMENT,0,R_MRG-T_IND-1,L_MRG_DEF)    BRKLH  IF ARGUMENT<=NUMBER    LH_MRG=PARAM(LH_MRG,VALUE,ARGUMENT,0,RH_MRG-T_IND-1,L_MRG_DEF)LF  IF ARGUMENT<=NUMBER    LF_MRG=PARAM(LF_MRG,VALUE,ARGUMENT,0,RF_MRG-T_IND-1,L_MRG_DEF)TI  IF Aincon rf=28   ;Right footer  margincon lf=29   ;Left  footer  margincon sh=30   ;Sub-headingcon pn=31   ;Initialize page numbercon ad=32   ;Add a file (like include in PROMAL)CON NMR_CMDS=33  ; always +1 max con numberCON UNKNOWN=NMR_CMDSCON INFGUMNT:>  ELSE    M[VALUE]=VAL:<    M[VALUE+1]=VAL:>END;Param sets a formatting parameter.FUNC INT PARAMARG INT CURR_VAL  ;Current valueARG INT NEW_VAL   ;New valueARG BYTE ARGTYPE  ;Argument typeARG INT LOW       ;Lower boundARG INT HIGH    LH_MRG+T_IND+1,INF,R_MRG_DEF)RF  IF ARGUMENT<=NUMBER    RF_MRG=PARAM(RF_MRG,VALUE,ARGUMENT,LF_MRG+T_IND+1,INF,R_MRG_DEF)TM  IF ARGUMENT<=NUMBER    T_MRG=PARAM(T_MRG,VALUE,ARGUMENT,0,PG_LN-H_MRG-F_MRG-B_MRG-3,T_MRG_DEF)HM  IF ARGUMENT<=NUMBER    E=0CON PLUS=1    ;Plus relativeCON MINUS=2   ;Minus relativeCON NUMBER=3  ;Absolute numberCON STRING=4;Abs returns the absolute value of an integer.FUNC INT ABS1ARG INT VALUEBEGINIF VALUE<0  RETURN -VALUEELSE  RETURN VALUEEND;Parse break[errcmmd],CURR_VAL,LOW  CURR_VAL=LOWIF CURR_VAL>HIGH  OUTPUT "#CERROR: .#s #I > #I",cmmds[errcmmd],CURR_VAL,HIGH  CURR_VAL=HIGHRETURN CURR_VALEND;Command executes a format command.PROC COMMANDARG WORD LINE  ;Command line bufferBYTE CMMD       -B_MRG-3,F_MRG_DEF)PL  IF ARGUMENT<=NUMBER    PG_LN=PARAM(PG_LN,VALUE,ARGUMENT,T_MRG+H_MRG+B_MRG+F_MRG+3,INF,PG_LN_DEF)LS  IF ARGUMENT<=NUMBER    SPACING=PARAM(SPACING,VALUE,ARGUMENT,1,INF,SPACING_DEF)SP  IF ARGUMENT<=NUMBER    LINES=PARAM(LINESargumentWORD LOOP     ;Loop counterWORD ARGUMNT  ;Pointer to argumentINT I         ;Command indexINT VAL       ;Argument valueBEGINI=LOOKSTR(LINE+1,CMMDS,NMR_CMDS,TRUE,2)IF I=-1  M[CMMD]=UNKNOWNELSE  M[CMMD]=I:<  LOOP=3  WHILE INSET((LINE+LOOENJ  IF ARGUMENT=NONE    JUSTIFY=FALSE    BRKCE  IF ARGUMENT=NONE    CENTER=TRUE    BRKNC  IF ARGUMENT=NONE    CENTER=FALSEUL  IF ARGUMENT=NONE    UNDERLINE=TRUENU  IF ARGUMENT=NONE    UNDERLINE=FALSEIN  IF ARGUMENT<=NUMBER    L_MRG=POdd headerCON OF=19   ;Odd footerCON EH=20   ;Even headerCON EF=21   ;Even footerCON BR=22   ;BreakCON BP=23   ;Begin pageCON CP=24   ;Conditional pageCON LI=25   ;Literal charactercon rh=26   ;Right heading margincon lh=27   ;Left  heading margNT)      M[ARGUMENT]=STRING    ELSE      VAL=ABS1(VAL)      CHOOSE ARGUMNT@<      '+'        M[ARGUMENT]=PLUS      '-'        M[ARGUMENT]=MINUS      ELSE        M[ARGUMENT]=NUMBER  IF ARGUMENT@< =STRING    M[VALUE]=ARGUMNT:<    M[VALUE+1]=ARRGUMENT<=NUMBER    T_IND=PARAM(T_IND,VALUE,ARGUMENT,-INF,R_MRG-L_MRG-1,T_IND_DEF)    BRKRM  IF ARGUMENT<=NUMBER    R_MRG=PARAM(R_MRG,VALUE,ARGUMENT,L_MRG+T_IND+1,INF,R_MRG_DEF)    BRKRH  IF ARGUMENT<=NUMBER    RH_MRG=PARAM(RH_MRG,VALUE,ARGUMENT,=10000word errcmmd;Command arrayDATA WORD CMMDS[]="FI","NF","JU","NJ","CE","NC","UL","NU","IN","TI","RM","TM","HM","BM","FM","PL","LS","SP","OH","OF","EH","EF","BR","BP","CP","LI","RH","LH","RF","LF","SH", "PN","AD",0;Argument typesCON NON  ;Upper boundARG INT DEFAULT   ;Default valueBEGINCHOOSE ARGTYPENONE  CURR_VAL=DEFAULTNUMBER  CURR_VAL=NEW_VALPLUS  CURR_VAL=CURR_VAL+NEW_VALMINUS  CURR_VAL=CURR_VAL-NEW_VALELSE  NOTHINGIF CURR_VAL<LOW  OUTPUT "#CERROR: .#s #I < #I",cmmdsH_MRG=PARAM(H_MRG,VALUE,ARGUMENT,0,PG_LN-T_MRG-F_MRG-B_MRG-3,H_MRG_DEF)BM  IF ARGUMENT<=NUMBER    B_MRG=PARAM(B_MRG,VALUE,ARGUMENT,0,PG_LN-T_MRG-H_MRG-F_MRG-3,B_MRG_DEF)FM  IF ARGUMENT<=NUMBER    F_MRG=PARAM(F_MRG,VALUE,ARGUMENT,0,PG_LN-T_MRG-H_MRG	s a command line up and evaluates the arguments.PROC PARSEARG WORD LINE       ;Command bufferARG WORD CMMD       ;Command number addressARG WORD ARGUMENT   ;Argument type addressARG WORD VALUE      ;Argument value addressBYTE INDEX    ;Index into 
;Command       BYTE ARGUMENT  ;Argument typeWORD VALUE     ;ArgumentBEGINPARSE LINE,#CMMD,#ARGUMENT,#VALUEerrcmmd=cmmdCHOOSE CMMDFI  IF ARGUMENT=NONE    PACK=TRUENF  IF ARGUMENT=NONE    PACK=FALSE    BRKJU  IF ARGUMENT=NONE    JUSTIFY=TRU,VALUE,ARGUMENT,0,INF,1)    SPACE LINESOH  IF ARGUMENT=STRING    MOVSTR VALUE,ODD_HEADEROF  IF ARGUMENT=STRING    MOVSTR VALUE,ODD_FOOTEREH  IF ARGUMENT=STRING    MOVSTR VALUE,EVEN_HEADERSH  IF ARGUMENT=STRING    MOVSTR VALUE,SUB_HEADEREF KKGE    THIS_PAGE=PARAM(THIS_PAGE,VALUE,ARGUMENT,0,INF,THIS_PAGE+1)    NEXT_PAGE=THIS_PAGEPN  IF ARGUMENT<=NUMBER    THIS_PAGE=PARAM(THIS_PAGE,VALUE,ARGUMENT,0,INF,1)    NEXT_PAGE=THIS_PAGECP  IF ARGUMENT<=NUMBER    COND_PAGE=PARAM(COND_PAGE,VALUEKKKKKKK IF ARGUMENT=STRING    MOVSTR VALUE,EVEN_FOOTERAD  IF ARGUMENT=STRING    if addflag      put nl,"Can't have .AD within .AD file",nl    else      MOVSTR VALUE,ADD_file      addflag=trueBR  IF ARGUMENT=NONE    BRKBP  IF ARGUMENT<=NUMBER    PAKK ,ARGUMENT,0,INF,1)    IF COND_PAGE>PG_LN-F_MRG-B_MRG-1-CURR_LINE      PAGELI  IF ARGUMENT=NUMBER    LITERAL VALUE:<ELSE  NOTHINGEND; --- End file DOCFOR2.S ---ile      addflag=trueBR  IF ARGUMENT=NONE    BRKBP  IF ARGUMENT<=NUMBER    PAKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK