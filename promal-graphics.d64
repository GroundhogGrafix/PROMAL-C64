KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKM[2]=SCNY2ELSE  GGYLIM[2]=YMAXENDexport PROC DRAWSHAPE ;SHAPE,X,Y,XSIZE,YSIZEARG WORD SHAPEARG REAL XARG REAL YARG REAL XSIZEARG REAL YSIZE;Draws a shape string at X,YBEGINMOVE X,YGGPENUP=1  ;pen up to startWHILE SHAPE@< <> 0  CHOOSE SHKK   'e'  ;southeast    IPLOT XSIZE,-YSIZE,0  'W'  ;west    IPLOT -XSIZE,0.,0  'w'  ;northwest    IPLOT -XSIZE,YSIZE,0  ELSE    NOTHING  SHAPE=SHAPE+1MOVE X,YEND; **** END OF GRAPHICS SUBROUTINES *****beginendWHILE SHAPE@< <> 0  CHOOSE SHKKKKKKKK	APE@<  'U' ;pen up    GGPENUP=1  'D' ;pen down    GGPENUP=0  'N'  ;north    IPLOT 0.,YSIZE,0  'n'  ;northeast    IPLOT XSIZE,YSIZE,0  'S'  ;south    IPLOT 0.,-YSIZE,0  's'  ;southwest    IPLOT -XSIZE,-YSIZE,0  'E'  ;east    IPLOT XSIZE,0.,0KKY;Translates origin to X,YBEGINGGGTFX[2]=GGGTFX[2]+GGTFX(X,Y,1)GGGTFY[2]=GGGTFY[2]+GGTFY(X,Y,1)ENDexport PROC SCALE ;SX,SYARG REAL SXARG REAL SY;Scales coordinate systemWORD IBEGINFOR I=0 TO 1  GGGTFX[I]=GGGTFX[I]/SX  GGGTFY[I]=GGGTFY[I]/ charbyte valuebeginvalue=charif char='@'  value=0if char=96  value=64if (char>96 and char<123)  value=char-96if (char>90 and char<96) or (char>159 and char<192)  value=char-64if (char>122 and char<128)  value=char-32if char<33 or (char>127 MOVE X,T1  REPEAT    DRAW GGX0,T2    MOVE GGX0+XTIC,T1  UNTIL GGX0>X2  MOVE X,Y  WHILE GGX0-XTIC >= X1    MOVE GGX0-XTIC,T1    DRAW GGX0,T2IF YTIC>0  T1=X-(XSIZE/2)  T2=T1+XSIZE  MOVE T1,Y  REPEAT    DRAW T2,GGY0    MOVE T1,GGY0+YTIC  UNN=0CON YMAX=199;BEGIN;Translate to screen coordinatesSCNX1=GGTFX(X1,Y1,0)SCNY1=GGTFY(X1,Y1,0)SCNX2=GGTFX(X2,Y2,0)SCNY2=GGTFY(X2,Y2,0);Arrange in ascending orderIF SCNX1>SCNX2  TEMP=SCNX1  SCNX1=SCNX2  SCNX2=TEMPIF SCNY1>SCNY2  TEMP=SCNY1 tes of endpointARG REAL YARG BYTE CONTROL ;type of move;Plots point with pen control parameterBEGINCHOOSE CONTROL0        ;move, pen unchanged  IF GGPENUP    MOVE X,Y  ELSE    DRAW X,Y1        ;pen down, then move  GGPENUP = 0  DRAW X,Y2    from ascii to  ;C-64 U/L SCREEN CODEARG BYTE COLARG BYTE LINEARG BYTE CHARWORD LOCWORD JBEGINchar=screencode(char)LOC=HRSCREEN+COL:+<<3 +320*LINEJ=CHARROM+CHAR:+<<3INTREG = INTREG AND $FE ;No interrupts allowed while ROM enabledMAPREG=MAPREGitto on y;Draws grid with endpoints indicated,;lower left corner at GGX0,GGY0.  Cursor left at GGX0,GGY0.REAL XREAL Y;BEGINX=GGX0Y=GGY0IF XTIC>0  MOVE X,Y  REPEAT    DRAW GGX0,Y1    MOVE GGX0+XTIC,Y  UNTIL GGX0>X1IF YTIC>0  MOVE X,Y  REPROC IMOVE ;X,YARG REAL XARG REAL Y;Incremental moveBEGINGGX0=GGX0+XGGY0=GGY0+YENDexport PROC IDRAW ;X,YARG REAL XARG REAL Y;Incremental drawBEGINX=GGX0+XY=GGY0+YDRAW X,YENDexport PROC IPLOT ;X,Y,CONTROLARG REAL XARG REAL YARG BYTEE COLARG BYTE LINEARG WORD STRINGARG WORD COLORS ;CHAR:BACKGROUNDWORD IBEGINI=40*LINE+COL+HRSCOLORFILL I,LENSTR(STRING),COLORSI=COLWHILE STRING@<  DRAWCHAR I,LINE,STRING@<  I=I+1  STRING=STRING+1ENDexport PROC AXES ;X1,X2,Y1,Y2,XTIC,YTIC, rt PROC GLOAD ;FDARG WORD FD;Loads the graphics screen and colormem from file FD.WORD SIZEBEGINSIZE=GETBLKF(FD,HRSCREEN,HRSCREENSIZE)IF SIZE=HRSCREENSIZE  SIZE=GETBLKF(FD,HRSCOLOR,HRSCOLORSIZE)ENDexport PROC TRANSLATE ;X,YARG REAL XARG REAL  PROC RPLOT ;X,Y,CONTROLARG REAL XARG REAL YARG BYTE CONTROL;Plot relative to GGRX0,GGRY0 with pen controlBEGINX=GGRX0+X      ;calc absolute endpointY=GGRY0+YPLOT X,Y,CONTROLENDfunc byte screencode; convert ASCII to c64 screen codesarg bytef tics on x axis (y units);Draws axes with endpoints indicated,;intersecting at GGX0,GGY0.  Cursor left at GGX0,GGY0.REAL XREAL YREAL T1REAL T2;BEGINX=GGX0Y=GGY0MOVE X1,YDRAW X2,YMOVE X,Y1DRAW X,Y2IF XTIC>0  T1=Y-(YSIZE/2)  T2=T1+YSIZE SYENDexport PROC CLIP ;X1,X2,Y1,Y2ARG REAL X1ARG REAL X2ARG REAL Y1ARG REAL Y2;Allows user to define an area of the screen outside of which;no lines will be drawn.INT TEMPINT SCNX1INT SCNX2INT SCNY1INT SCNY2CON XMIN=0CON XMAX=319CON YMI and char<160)  value=' ' ; blank since no screen codes existsif (char>191 and char<224)  value=char-96if (char>223 and char<=255)  value=char-128return valueendexport PROC DRAWCHAR ; COL,LINE,CHAR  ;DISPLAY CHAR IN HIRES MODE  ;char convertedTIL GGY0>Y2  MOVE X,Y  WHILE GGY0-YTIC >= Y1    MOVE T1,GGY0-YTIC    DRAW T2,GGY0MOVE X,YENDexport PROC GRID ;X1,Y1,XTIC,YTICARG REAL X1 ;endpoint of x axisARG REAL Y1 ;endpoint of y axisARG REAL XTIC ;units between tics on xARG REAL YTIC ;d SCNY1=SCNY2  SCNY2=TEMP;Set limits, but check that not out of rangeIF SCNX1>XMIN  GGXLIM[1]=SCNX1ELSE  GGXLIM[1]=XMINIF SCNX2<XMAX  GGXLIM[2]=SCNX2ELSE  GGXLIM[2]=XMAXIF SCNY1>YMIN  GGYLIM[1]=SCNY1ELSE  GGYLIM[1]=YMINIF SCNY2<YMAX  GGYLI     ;pen up, then move  GGPENUP = 1  MOVE X,Y3        ;move, then pen down  PLOT X,Y,0  GGPENUP = 04        ;move, then pen up  PLOT X,Y,0  GGPENUP = 1ELSE     ;error  TEXT  ABORT "#C***ERROR-ILLEGAL PEN CONTROL-#W#C",CONTROL:+ENDexport P AND $FB ;ENABLE ROMBLKMOV J,LOC,8MAPREG=MAPREG OR $04 ;DISABLE ROMINTREG = INTREG OR $01  ;Restore interruptsENDexport PROC LABEL ;COL, LINE,STRING,COLORS  ;DISPLAY STRING IN HI-RES  ;char converted from ascii to  ;C-64 U/L SCREEN CODEARG BYT	EAT    DRAW X1,GGY0    MOVE X,GGY0+YTIC  UNTIL GGY0>Y1MOVE X,YENDexport PROC GSTORE ;FDARG WORD FD;Stores the graphics screen and colormem to file descriptor FD.BEGINPUTBLKF FD,HRSCREEN,HRSCREENSIZEPUTBLKF FD,HRSCOLOR,HRSCOLORSIZEENDexpo
 CONTROL;Incremental plot with pen controlBEGINX=GGX0+XY=GGY0+YPLOT X,Y,CONTROLENDexport PROC RMOVE ;X,YARG REAL XARG REAL Y;Place relative cursor GGRX0,GGRY0 at X,YBEGINGGRX0=XGGRY0=YMOVE X,Y  ;put regular cursor there also.ENDexportXSIZE,YSIZEARG REAL X1 ;endpoint of x axisARG REAL X2 ;dittoARG REAL Y1 ;endpoint of y axisARG REAL Y2 ;dittoARG REAL XTIC ;units between tics on xARG REAL YTIC ;ditto on yARG REAL XSIZE ;length of tics on y axis (x units)ARG REAL YSIZE ;length o+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGNORTH    GGWEST  ELSE  ;One step required    GGWEST  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGOCT5 ;DX,DYARG INT DXARG INT DY;Draws line in octant 5INT COUNTINT EPS;BEGIN;Cst/southeast    GGOCT0 DX,DY  8  ;south/southeast    GGOCT1 DX,DY  10 ;south/southwest    GGOCT2 DX,DY  2  ;west/southwest    GGOCT3 DX,DY  6  ;west/northwest    GGOCT4 DX,DY  14 ;north/northwest    GGOCT5 DX,DY  12 ;north/northeast    GGOCT(PX2@-,GGXLIM[1],GGXLIM[2])IY2=RANGE(PY2@-,GGYLIM[1],GGYLIM[2])IF (IX1+IX2+IY1+IY2)=0  NOTHING     ;draw whole lineELSE IF (PX1@- = PX2@-) AND IX1=0  ;vertical line  IF IY1    BLKMOV #GGYLIM[IY1],PY1,2  IF IY2    BLKMOV #GGYLIM[IY2],PY2,2ELSE IF in octant 0INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGSOUTH    GGEAST  ELSE  ;One step required    GGEAST  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGOCTe in octant 6INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGNORTH    GGEAST  ELSE  ;One step required    GGNORTH  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGO1@-  Y1=PY1@-  X2=PX2@-  Y2=PY2@-  SLOPE = (Y2-Y1):. / (X2-X1)  IF IX1         ;move X1 to nearest limit    Y1=Y1+((GGXLIM[IX1]-X1)*SLOPE):-    X1=GGXLIM[IX1]    IY1=RANGE(Y1,GGYLIM[1],GGYLIM[2])  IF IY1         ;move Y1 to nearest limit    X1=n on pixel  COUNT=COUNT+1ENDPROC GGOCT2 ;DX,DYARG INT DXARG INT DY;Draws line in octant 2INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGSOUTH    GGWEST  ELSE  ;Orn on pixel  COUNT=COUNT+1ENDexport PROC DRAW  ; X1, Y1  ;DRAW LINE FROM (GGX0,GGY0) TO COORDS,  ;UPDATE (GGX0,GGY0) TO NEW ENDPOINTARG REAL X1ARG REAL Y1;LocalsINT SCNX0 ;screen coordinatesINT SCNY0INT SCNX1 ;screen coordinatesINT SCNY1INGGYLIM[2])  IF IY2         ;move Y2 to nearest limit    X2=X2+((GGYLIM[IY2]-Y2)/SLOPE):-    Y2=GGYLIM[IY2]  BLKMOV #X1,PX1,2   ;change endpoints in memory  BLKMOV #X2,PX2,2  BLKMOV #Y1,PY1,2  BLKMOV #Y2,PY2,2RETURN 1ENDPROC GGEAST ;Moves GGAD PS=EPS-DX    GGSOUTH    GGWEST  ELSE  ;One step required    GGWEST  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGOCT4 ;DX,DYARG INT DXARG INT DY;Draws line in octant 4INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPSxel  GGPLOT  DX=SCNX1-SCNX0  DY=SCNY1-SCNY0  ;Calculate octant index  I=0  IF DX<0    DX=-DX    I=2  IF DY<0    DY=-DY    I=I+4  IF DX<DY ;interchange dx,dy    TEMP=DX    DX=DY    DY=TEMP    I=I+8  CHOOSE I  ;go to proper octant  0  ;ea (GGADDR:< AND 7) = 0  GGADDR=GGADDR-313 ;next char blockELSE  GGADDR=GGADDR-1ENDPROC GGSOUTH ;Moves one pixel downBEGINIF (GGADDR:< AND 7) = 7  GGADDR=GGADDR+313ELSE  GGADDR=GGADDR+1ENDPROC GGOCT0 ;DX,DYARG INT DXARG INT DY;Draws lineOUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGNORTH    GGWEST  ELSE  ;One step required    GGNORTH  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGOCT6 ;DX,DYARG INT DXARG INT DY;Draws lin6 DX,DY  ELSE ;4  east/northeast    GGOCT7 DX,DY;GGX0 = X1    ;ready for nextGGY0 = Y1    ENDexport PROC MOVE ;X,Y;  MOVE GRAPHIC "CURSOR" TO X,YARG REAL XARG REAL YBEGINGGX0=XGGY0=YENDexport PROC PLOT ;X,Y,CONTROLARG REAL X ;coordina (PY1@- = PY2@-) AND IY1=0  ;horizontal line  IF IX1    BLKMOV #GGXLIM[IX1],PX1,2  IF IX2    BLKMOV #GGXLIM[IX2],PX2,2ELSE IF (IX1=IX2 AND IX1<>0) OR (IY1=IY2 AND IY1<>0)  RETURN 0       ;Line missesELSE             ;Must clip sloping line  X1=PX1 ;DX,DYARG INT DXARG INT DY;Draws line in octant 1INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGSOUTH    GGEAST  ELSE  ;One step required    GGSOUTH  GGPLOT  ;TurCT7 ;DX,DYARG INT DXARG INT DY;Draws line in octant 7INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    EPS=EPS-DX    GGNORTH    GGEAST  ELSE  ;One step required    GGEAST  GGPLOT  ;TuX1+((GGYLIM[IY1]-Y1)/SLOPE):-    Y1=GGYLIM[IY1]  IX1=RANGE(X1,GGXLIM[1],GGXLIM[2])  IF IX1         ;line misses    RETURN 0  IF IX2         ;move X2 to nearest limit    Y2=Y2+((GGXLIM[IX2]-X2)*SLOPE):-    X2=GGXLIM[IX2]    IY2=RANGE(Y2,GGYLIM[1],	ne step required    GGSOUTH  GGPLOT  ;Turn on pixel  COUNT=COUNT+1ENDPROC GGOCT3 ;DX,DYARG INT DXARG INT DY;Draws line in octant 3INT COUNTINT EPS;BEGIN;COUNT=1EPS=-DX/2WHILE COUNT<=DX  EPS=EPS+DY  IF EPS>=0  ;Two steps required    E
T DXINT DYINT TEMPBYTE I   ;index to octant;BEGINSCNX0=GGTFX(GGX0,GGY0,0)SCNY0=GGTFY(GGX0,GGY0,0)SCNX1=GGTFX(X1,Y1,0)SCNY1=GGTFY(X1,Y1,0)IF GGCLIP(#SCNX0,#SCNY0,#SCNX1,#SCNY1)  ;Proceed if GGCLIP is true  GGPLACE SCNX0,SCNY0 ;turn on first piDR and GGBIT one pixel rightBEGINIF GGBIT=1  GGADDR=GGADDR+8  GGBIT=128ELSE  GGBIT=GGBIT>>1ENDPROC GGWEST ;Moves one pixel leftBEGINIF GGBIT=128  GGADDR=GGADDR-8  GGBIT=1ELSE  GGBIT=GGBIT<<1ENDPROC GGNORTH ;Moves one pixel upBEGINIFprogram graphics own export;REVISION DATE 7 AUGUST 1985;Graphics library.  Uses $A000-$BF40 for;hires screen, and $8C00-$8FE8 for color;memory.include library;Promal addresses:EXT BYTE EDRES AT $0CFB  ;Editor residentEXT WORD LOFREE AT $0C18 ;Ne$03 ;set CIA to outputsCIAD=CIAD AND $FC OR (((TEXTMEM:> XOR $FF)>>6) AND $03) ;select VIC bankVICCR=VICCR AND $DF ;deselect bit map mode;set upper nibble for text mem and lower nibble for char set 2VICMCR=((TEXTMEM:> AND $3C)<<2) OR $07ENDexportrent coordinate system.;If NOTRANS is true, then the translation term is not included,;(for relative coordinates).REAL RYBEGINRY=X*GGGTFY[0]+Y*GGGTFY[1]IF NOT NOTRANS  RY=RY+GGGTFY[2]RETURN RY:-ENDPROC GGPLOT;Changes bit at GGADDR, GGBIT accREEN[] AT $A000 ;HIRES CON HRSCREENSIZE=8000 CON TEXTMEM=$0400 ;LOCATION OF TEXT SCREENEXT BYTE MAPREG AT $0001 ; MEM MAP REGEXT BYTE INTREG AT $DC0E ;INT. REGEXT BYTE CHARROM[] AT $D800 ;U/L FONTEXT BYTE BORDER AT $D020DATA REAL ASPECT=1.3334;es coordinate systemBEGINGGXLIM[1]=0       ;Initialize limit vectorsGGXLIM[2]=319GGYLIM[1]=0GGYLIM[2]=199     GGX0=0.GGY0=0.GGRX0=0.GGRY0=0.GGPENUP=1 ;pen upPEN 0     ;normal pen type;initialize transformation arraysGGGTFX[0]=ASPECT   ;SCALEplements dot  HRSCREEN[GGADDR]=HRSCREEN[GGADDR] XOR GGBITENDPROC GGPLACE ;SCNX,SCNYARG INT SCNX   ;screen coordinatesARG INT SCNY;Calculates the memory address and bit place;of point SCNX,SCNY.  Result is placed in the globals GGADDR, GGBIT.BYT2 in GGADDRBYTE GGPEN  ;Type of penBYTE GGPENUP;Flag true if pen is "up"REAL GGGTFX[3] ;Coordinate transformation arrayREAL GGGTFY[3]export PROC GCLEAR ;PIXCOLOR,BACKCOLORARG BYTE PIXCOLORARG BYTE BACKCOLOR;Clears graphics screenBEGINFILL HRS conflict  PUT "***ERROR: CONFLICT WITH GRAPHICS SCREEN",CR  PUT "TRY UNLOADING UNNECESSARY PROGRAMS",CR  ABORTEDRES = 0   ;Graphics screen overwrites the editorENDexport PROC GINIT ;PIXCOLOR,BACKCOLORARG BYTE PIXCOLORARG BYTE BACKCOLOR;ClearsXINT SCNYBEGINSCNX=GGTFX(X,Y,0)     ;transform XSCNY=GGTFY(X,Y,0)     ;transform YGGPLACE SCNX,SCNY     ;calc addressGGPLOTENDFUNC BYTE RANGE ;(I,MIN,MAX)ARG INT I    ;number to be testedARG INT MINARG INT MAX;Tests I.  Returns 0 if withinset upper nibble for color mem and bit 3 for graphics locationVICMCR=((HRSCOLOR:> AND $3C)<<2) OR ((HRSCREEN:> AND $20)>>2)                   VICCR=VICCR OR $20 ;select bit map modeENDexport PROC TEXT  ;RESTORE CHARACTER MODEBEGINCIADD=CIADD OR  then the translation term is not included,;(for relative coordinates).REAL RXBEGINRX=X*GGGTFX[0]+Y*GGGTFX[1]IF NOT NOTRANS  RX=RX+GGGTFX[2]RETURN RX:-ENDFUNC INT GGTFY ;X,Y,NOTRANSARG REAL XARG REAL YARG BYTE NOTRANS;Transforms X,Y to curangle defined by;GGXLIM[1,2] and GGYLIM[1,2].  Returns TRUE if line should be drawn.INT X1INT Y1INT X2INT Y2BYTE IX1BYTE IY1BYTE IX2BYTE IY2REAL SLOPE;BEGIN;IX1=RANGE(PX1@-,GGXLIM[1],GGXLIM[2])IY1=RANGE(PY1@-,GGYLIM[1],GGYLIM[2])IX2=RANGExt available memory locationEXT BYTE CIADD AT $DD02 ; DIR REG FOR..EXT BYTE CIAD AT $DD00  ; BANK SEL VICEXT BYTE  VICMCR AT $D018 ;6566 CHIPEXT BYTE  VICCR  AT $D011 ;CNTRL REGEXT BYTE HRSCOLOR[] AT $8C00 ;COLORCON HRSCOLORSIZE=1000EXT BYTE HRSC PROC PEN ;TYPEARG BYTE TYPE;Changes type of drawing pen.  Zero is normal,;one is an eraser, and two is a complementing type.BEGINIF TYPE>3  TEXT  ABORT "#C***ERROR: PEN TYPE UNDEFINED - #W",TYPE:+GGPEN = TYPEENDexport PROC RESTORE;Initializording to current pen type.BEGINIF GGADDR > HRSCREENSIZE  RETURNCHOOSE GGPEN0 ;normal, black pen  HRSCREEN[GGADDR]=HRSCREEN[GGADDR] OR GGBIT1 ;eraser, white pen                      HRSCREEN[GGADDR]=HRSCREEN[GGADDR] AND (GGBIT XOR $FF)ELSE  ;com DRAWING VARIABLES...REAL GGX0    ;Current graphic cursor locationREAL GGY0WORD GGADDR ;Addr of GGX0,GGY0REAL GGRX0   ;Relative cursor locationREAL GGRY0INT GGXLIM[3] ;Min and max limits of screen XINT GGYLIM[3] ;and screen Y.BYTE GGBIT  ;Pwr of  by ASPECT,-1GGGTFX[1]=0.       ;and TRANSLATE to 0,-199GGGTFX[2]=0.GGGTFY[0]=0.GGGTFY[1]=-1.GGGTFY[2]=199.ENDexport PROC CHECK_GRMEM;Checks for conflict between graphics screen and program memoryBEGINIF LOFREE > HRSCOLOR   ;check for memoryE ROW ;ROW # OF 8X8 CELLBYTE LN  ;LINE # WITHIN 8X8 CELL;BEGINROW=SCNY:< >>3LN=SCNY:< AND 7GGADDR=ROW*320 + SCNX>>3<<3 + LNGGBIT = $80>>(SCNX:< AND 7)ENDexport PROC DRAWDOT ; X, Y  ;DRAW DOT IN HIRES MODEARG REAL XARG REAL Y;LocalsINT SCN	CREEN,HRSCREENSIZE,0FILL HRSCOLOR,HRSCOLORSIZE,(PIXCOLOR<<4 OR BACKCOLOR)ENDexport PROC GSHOW  ;Displays HI-RES graphics screenBEGINCIADD=CIADD OR $03 ;set CIA to outputsCIAD=CIAD AND $FC OR (((HRSCREEN:> XOR $FF)>>6) AND $03) ;select VIC bank;
, shows graphics screen.  Initializes coordinate system.BEGINCHECK_GRMEMGCLEAR PIXCOLOR,BACKCOLORGSHOWRESTOREENDFUNC INT GGTFX ;X,Y,NOTRANSARG REAL XARG REAL YARG BYTE NOTRANS;Transforms X,Y to current coordinate system.;If NOTRANS is true, limits,;1 if < MIN, and 2 if > MAX.BEGINIF I<MIN  RETURN 1ELSE IF I>MAX  RETURN 2ELSE  RETURN 0ENDFUNC BYTE GGCLIP ;(PX1,PY1,PX2,PY2)ARG WORD PX1 ;Addr of X1ARG WORD PY1ARG WORD PX2ARG WORD PY2;Adjusts X1,Y1 and X2,Y2 to fit inside rectA                     	iIPROMAL GRAPHICSPG2A                                                                                       GRAPHICS.S         B    GRAPHICS.E            GRAPHICS.C             GRAPHICS_DOC.T                                                                                                                                          KKKKKKKKKKKKKKKKKIMPORT GRAPHICS ;11/ 5/86  EXT PROC DRAWSHAPE AT $0F01  EXT PROC CLIP AT $0E37  EXT PROC SCALE AT $0E0D  EXT PROC TRANSLATE AT $0DD9  EXT PROC GLOAD AT $0DB0  EXT PROC GSTORE AT $0D94  EXT PROC GRID AT $0D15  EXT PROC AXES AT $0BEE  EXT PROC LA      M   VGRAPHICS      " ?<F  2@h&* 2@0@&*F  0 0 000  0<l 0 l0 F  0 02 000 02 0<l0F @0$ (s @&<@'  #C***ERROR: PEBBPBh$BBP((t"(t(|BjP"FjPBlPBB~$IBBPBh$9BBP((t"<(t(|BjP"FjPBlPBB~$BBPBh$BBP((t"((|BjP"YFjPBlPBB~$BBPBh$BBP((N"((|Bj ROC DRAWDOT AT $0307  EXT PROC GINIT AT $0204  EXT PROC CHECK_GRMEM AT $018C  EXT PROC RESTORE AT $00F4  EXT PROC PEN AT $00AF  EXT PROC TEXT AT $0073  EXT PROC GSHOW AT $0030  EXT PROC GCLEAR AT $000D $0D15  EXT PROC AXES AT $0BEE  EXT PROC LAREEN TRY UNLOADING UNNECESSARY PROGRAMS F (@@( (0 ( FLDh) Dj) R@$BDl) RDXXFLDh; Dj; R@$sDl; RDXXF   2@$' h*   &  "j*   & 0 "   &  FB0N"3	0*BB(."3	0
*BB(u"3	l*BB("3	0*	BB("3	0*	BB(J"3	0*+	BB("3	BB(D  D XF D  D XF @h*w	( $k	DD(@	"t	DD("	j*	h( DD("	l*	j( DD(@	"	0*	DDh(P	h( "	0*	DDh(P	j( "P	B$B	@B(HB	jP	BjP"FLLLL  R RDD(@	DD(DD(@	DD(D	h$DDlRDDRDD(@	  D(  D	D(@	  D$IDD(@	  D	D$  D	D(@	  D("rDh$	DDlRDDRDD(@	D (D@  Bl&0"GBB@h$!@$@ Bl&0@$@ Bl&0"G@@@h@@@h$@hX"GBP	BPBPBPBBBB	R@$B@ B	DP@ P	Bj  l  (1N@$B	@  BDP	@  PB	j l (1N@$hX@$B@N@0Z@0`r@0@0r$
@0@N@0z@0r$@0 N@0!r@0@0r$0 N@0@0r$/@0`N@0@0z$D@0N@F@(
N @02@@P @0P	0 0 B	B0&0 0 jF0(@@ P	B	B&6B&*@@$B 2&KPF ll) DDj() ll; DDj(K; XF>hPjnBB) D) BB; D; XF
DDh(PDDh(KPDDh(PDDh(KPBB$BP	BPB	PBB$BP	BPB	PBh$jB "jh B2?v$lB "9 " j FjPBlPBB~$-BBPBh$BBP((N" (N(|BjP"FjPBlPBB~$tBBPBh$dBBP((N"g((|BjP"=FjPBlPBB~$BBPBh$BBP((t"((|BjP"FjPBlPBB~$BEL AT $0BA2  EXT PROC DRAWCHAR AT $0B48  EXT PROC RPLOT AT $0A77  EXT PROC RMOVE AT $0A5E  EXT PROC IPLOT AT $0A3C  EXT PROC IDRAW AT $0A1D  EXT PROC IMOVE AT $0A05  EXT PROC PLOT AT $0950  EXT PROC MOVE AT $0940  EXT PROC DRAW AT $081F  EXT PN TYPE UNDEFINED - #W F  jh l2? jh  l0  4        4       4       4       j( h( h; ) j4      ) l4      ) h4      ; j4?    ; l4CG    ; F  	 $0&0&&< h***ERROR: CONFLICT WITH GRAPHICS SCP"FjPBlPBB~$BBPBh$BBP((N"(N(|BjP"F   h(P   h(KPDDh(P	DDh(KP>>>	>(Q$3	BB((|B	BPBBPhNBhv$BPlNBhv$BP@0NBBv$BPBPBP@0N@h*BB(l2? Bh$jB  "jh  B0v$lB  "l0  XF
 DD(@	j( Bh$B0U*(j( "0D*4h( "0N*L4      D	h(<
"0n*_DD	h(<
"0S*x4      D	h(<
"0s*DD	h(<
"0E*D4      h(<
"0e*DD	h(<
"0W*DB0N@2@B00@ 0B0& FDDh(PDDh(KPBB((|XF BBv$Aj"PBB$Nl"PhFLBj l (1NBj  l  (1NBj l (1NBj  l  (1N@@@@h$"GBB@h$@$@  Bl&0@$	(s @&<X
#C***ERROR-ILLEGAL PEN CONTROL-#W#C F   D   D XF   DR DRDD(XF   DR DRDD@(P	XF D D DD(@	XF  DR DRDD@(P	XF@N@0@$
hN@0`$
0@N@0`@0{r$
@0`	 D(@	 D$DD(@	 DD$	D D(@	D ("DD(@	XHFL	L
  R	 R
Dh$WD	D
(@	  D(  DD
(@	  D$7Dh$D	D
(@	D (D	 D(@	 D$hD	D
(@	X$F B 2@&NB 2&NFB 2@&KPB2
 BDP@ PBj  l  (1N@$B@  BDP@  P>	Bl&0>Bl&0>Bl&0>Bl&0jXXF  & j$k 0 0& "s& j& F  & 0$ 0 j& "& j& F   0h$ 29 " j F   00$ 2This describes a group of routines that forms a PROMAL graphics library.The routines uses $A000-$BF40 for the graphics screen,and $8C00-$8FE8 for the color memory.graphics.(c/e/s) copied from graphlib_2.sWritten by R. D. Norrod.Modified by C. A. Mand shows graphics screen.  Initializes coordinate system by;calling RESTORE.PROC DRAWDOT ; X, YARG REAL XARG REAL Y;Draws dot at coordinate X,Y.  The graphics cursor is not moved.PROC DRAW  ; X, Y;Draws line from the graphics cursor to X,Y.;HLIB_2.S'.A short description follows of the routines which a user would normally call.Other, lower level, routines are in the graphics library.The routines below are exported.Unless otherwise noted below, the X,Y coordinates required by theprocedu your soucecode.  Get graphics before loading yourcompiled program.Many of the routines call the PROMAL Library, so it must beincluded when they are used.  The global variables declared in the graphics library are:EXT BYTE CIADD AT $DD02 ; direcl parameter.;Possible values of CONTROL are:;  0:  Move, pen unchanged;  1:  Pen down, then move;  2:  Pen up, then move;  3:  Move, then pen down;  4:  Move, then pen upPROC IMOVE ;X,YARG REAL XARG REAL Y;Incremental move from current cursornges type of drawing pen.  Zero is normal,;one is an eraser, and two is a complementing type.PROC RESTORE;Initializes coordinate system.  The screen is defined as X: 0 to 239 and;Y: 0 to 199, with 0,0 in the lower left corner of the screen.;Pen ty \4      h(<
"0w*DD	h(<
"BjP"DD(@	XRF   		   D) BB; D; XF
DDh(PDDh(KPDDh(PDDh(KPBB$BP	BPB	PBB$BP	BPB	PBh$jB "jh B2?v$lB "IZE=8000 CON TEXTMEM=$0400 ;location of text screenEXT BYTE MAPREG AT $0001 ; memory map registerEXT BYTE INTREG AT $DC0E ;interrupt registerEXT BYTE CHARROM[] AT $D800 ;upper/lower fontEXT BYTE BORDER AT $D020DATA REAL ASPECT=1.3334 ;screen aspect memory;Aborts if conflict, otherwise Promal EDRES flag false.;(The graphics screen overwrites the Promal EDITOR)PROC GINIT ;PIXCOLOR,BACKCOLORARG BYTE PIXCOLORARG BYTE BACKCOLOR;Calls CHECK_GRMEM to check for program conflict.  If none,;clears RMOVE ;X,YARG REAL XARG REAL Y;Place relative cursor at X,Y absolute coordinates.;Regular graphics cursor is put there also.PROC RPLOT ;X,Y,CONTROLARG REAL XARG REAL YARG BYTE CONTROL;Plot relative to the relative cursor with pen control.;The screen coordinates.BYTE GGBIT     ;Pwr of 2 in GGADDRBYTE GGPEN     ;Type of penBYTE GGPENUP   ;Flag true if pen is "up"REAL GGGTFX[3] ;Coordinate transformation arrayREAL GGGTFY[3]The PROMAL source code for the graphics library is in file 'GRAPcDowell 11/06/86REVISION DATE: 7 August 1985REFERENCES:  I. O. Angell, 'A PRACTICAL INTRODUCTION TO COMPUTER GRAPHICS'  F. Covitz, COMMODORE MAGAZINE, Vol. 4, No. 4, Issue 25, p14  PROMAL System Disk, 'GRAPHDEMO.S'.To use, include graphics.e inMoves the cursor to X,Y.ARG REAL XARG REAL YPROC MOVE ;X,Y;Moves the graphics cursor to X,YARG REAL XARG REAL YPROC PLOT ;X,Y,CONTROLARG REAL XARG REAL YARG BYTE CONTROL ;Pen control parameter.;Draws line from cursor to X,Y with pen controres are absolute screen coordinates.PROC GCLEAR ;PIXCOLOR,BACKCOLORARG BYTE PIXCOLORARG BYTE BACKCOLOR;Clears graphics screen.PROC GSHOW;Displays HI-RES graphics screen.PROC TEXT;Restores character mode.PROC PEN ;TYPEARG BYTE TYPE;Chation register for EXT BYTE CIAD AT $DD00  ; VIC bank selectEXT BYTE  VICMCR AT $D018 ;VIC registersEXT BYTE  VICCR  AT $D011 ;EXT BYTE HRSCOLOR[] AT $8C00 ;color memoryCON HRSCOLORSIZE=1000EXT BYTE HRSCREEN[] AT $A000 ;graphics screenCON HRSCREENS	 location.PROC IDRAW ;X,YARG REAL XARG REAL Y;Incremental draw from current cursor location.PROC IPLOT ;X,Y,CONTROLARG REAL XARG REAL YARG BYTE CONTROL;Incremental plot with pen control.;See PLOT for action of the CONTROL parameter.PROC pe 0 is selected, with the pen up, and the cursor is placed at 0,0.;This particular screen scale was chosen because it results in;a 1:1 aspect ratio, i.e., squares look square.PROC CHECK_GRMEM;Checks for conflict between graphics screen and program	 relative cursor is not moved, but the regular graphics cursor is.;See PLOT for action of the CONTROL parameter.PROC DRAWCHAR ; COL,LINE,CHARARG BYTE COLARG BYTE LINEARG BYTE CHAR;Display character on the graphics screen.PROC LABEL ;COL, LINE,
 ratio; DRAWING VARIABLES...REAL GGX0    ;Current graphic cursor locationREAL GGY0WORD GGADDR ;Addr of GGX0,GGY0REAL GGRX0   ;Relative cursor locationREAL GGRY0INT GGXLIM[3]  ;Min and max limits of XINT GGYLIM[3]  ;and Y, after transformation toKL X1 ;endpoint of x axisARG REAL X2 ;dittoARG REAL Y1 ;endpoint of y axisARG REAL Y2 ;dittoARG REAL XTIC ;units between tics on xARG REAL YTIC ;ditto on yARG REAL XSIZE ;length of tics on y axis (x units)ARG REAL YSIZE ;length of tics on x axis (yZE units (West);   'U' - Pen up;   'D' - Pen down;A lowercase N, E, S, or W causes the move to be in a direction rotated;clockwise by 45 degrees.;The pen is automatically up at the start string.;The graphics cursor is left at X,Y.; **** END OF GKL YTIC ;ditto on y;Draws grid with endpoints indicated,;lower left corner at the graphics cursor.  Cursor is not moved.PROC GSTORE ;FDARG WORD FD;Stores the graphics screen and colormem to file descriptor FD.;The file must be open when this routiKKive.PROC SCALE ;SX,SYARG REAL SXARG REAL SY;Scales coordinate system by the factors SX and SY.;Multiple calls to SCALE are cumulative.PROC CLIP ;X1,X2,Y1,Y2ARG REAL X1ARG REAL X2ARG REAL Y1ARG REAL Y2;Allows user to define an area of the sKSTRING,COLORSARG BYTE COLARG BYTE LINEARG WORD STRING ;Address of the stringARG WORD COLORS ;Character/Background in the upper/lower nibbles of low byte.;Display a string on the graphics screen.PROC AXES ;X1,X2,Y1,Y2,XTIC,YTIC,XSIZE,YSIZEARG REAllowing characters:;   'N' - Move in the positive Y direction YSIZE units (North);   'E' - Move in the positive X direction XSIZE units (East);   'S' - Move in the negative Y direction YSIZE units (South);   'W' - Move in the negative X direction XSIK units);Draws axes with endpoints indicated,;intersecting at the graphics cursor.  Cursor left at same location.PROC GRID ;X1,Y1,XTIC,YTICARG REAL X1 ;endpoint of x axisARG REAL Y1 ;endpoint of y axisARG REAL XTIC ;units between tics on xARG REA RAPHICS SUBROUTINES ***** - Move in the positive Y direction YSIZE units (North);   'E' - Move in the positive X direction XSIZE units (East);   'S' - Move in the negative Y direction YSIZE units (South);   'W' - Move in the negative X direction XSIKne is called.PROC GLOAD ;FDARG WORD FD;Loads the graphics screen and colormem from file FD.;The file must be open when this routine is called.PROC TRANSLATE ;X,YARG REAL XARG REAL Y;Translates origin to X,Y.  Multiple translations are cumulatKK
creen outside of which;no lines will be drawn.PROC DRAWSHAPE ;SHAPE,X,Y,XSIZE,YSIZEARG WORD SHAPE ;shape string pointerARG REAL XARG REAL YARG REAL XSIZEARG REAL YSIZE;Draws a shape string at X,Y.  The string consists of a collection;of the foKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK