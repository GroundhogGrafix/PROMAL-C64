KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK          return key code (see pp 3-88, B-1) C. STRING MANIPULATION ~~~~~~~~~~~~~~~~~~~~~~byte=CMPSTR(#string1,"op",#string2[,fold true/false][,limit 0-255])     compare two strings     op = <,>,<=,>=,=,<>     fold = true match both upper/lower  earch in     fold = true if lower=upper case, else false     max  = 1 to lenstr(try.string)     limit = 1 to lenstr(want.string)today"     MOVSTR "today",line+lenstr(line)     line=""               line[0]=0     insert into a line    MOVSTR line,liK     #string = <= 31 bytes + $00FKEYSET 1-8,#string             set function key value     #string = <= 31 bytes + $00byte=GETC [(#byte)]             get byte from keyboard, waits and echos     byte=keyboard char ($1A = CTRL-Z)byte=GETKEY [(#bytray - 1     seperator char = $01 to $ff, default is ' 'byte=INSET(char,string[,meta])  index or verify     byte = 0 if not found, else = index+1     char = byte to check     string = denote range to search for "A-Za-z0-9."     meta = defaults to 'Kimit][,mode][,#col])     same as EDLINE except string is nulled before inputOUTPUT formatstring[,item1,item2,...]          formatted output       formatstring = #nI - signed decimal INT                      #nW - unsigned decimal WORD              .array     word.array = last entry contains $0000 if no maxnum     fold = true if lower=upper case, else false     limit = max length of string to match, no default.bpMOVSTR #fromstring,#tostring[,limit]    copy string values     key=left$(line,4) K                   #n.dR - REAL, n wide with d decimal places                            (3<=n<=12 and d<n-1)       *** output if number too big       n is padding numberPUT item1,item2,...             output strings or bytesbyte=TESTKEY [(#byte)]ne+1                           line[0]='A'byte=SUBSTR(#want.string,#try.string[,fold[,max[,limit]]])     find a string within a string     byte = 0 if not found, else position + 1     want.string = string to search for     try.string = string to sKcase, false (default) same case     byte = true or false based on op resultbyte=GETARGS(#tmp.string,#word array[,limit[,seperator char]     break up (parse) a string     #tmp.string = copy of string to parse, destructive     limit = size of word arKKe)]           get byte from keyboard, waits, no echo     byte=keyboard char ($1A = CTRL-Z)GETL #tostring[,limit]          get line from keyboard with exec edit     limit = 80 default for C-64     tostring size must be limit+1byte=INLINE(#string[,l-', specifies ranges in stringbyte=LENSTR(#string)            returns length of the stringint=LOOKSTR(#string.to.search.for,#word.array.to.search[,maxnum[,fold[,limit]     search an array of strings     int = -1 if not found, else index within wordK
        #nH - unsigned hex WORD or BYTE             <no arg> #nB - blanks                      #nS - string or char             <no arg> #nC - n=decimal ASCII code, if no n then CR                      #nE - scientific REAL, n=12 default (7<=n<=16)     MOVSTR line,key,4     key=right$(line,10)   MOVSTR line+10,key     key=mid$(line,10,4)   MOVSTR line+10,key,4     line=line+"today"     MOVSTR "today",line+lenstr(line)     line=""               line[0]=0     insert into a line    MOVSTR line,liorresponds to disk I/O error numbersCLINE       -  Array type byte containing the input command lineEND Operators ~~~~~~~~~+,-,*,/,and,or,xor,not,>,<,>=,<=,<>,=,true,false   NOTE: * and / of type BYTE results in type WORD%  Remainder (modulo)       limit = size of display string - 1, default=80     mode  = BIT HEX  DESCRIPTION              0  $01  reverse video (normal video)              1  $02  raw code function key (expand function key)              2  $04  return TESTKEY values of straexcept when loaded no unloading to make room occurs. - Mainly for documentation that this module is not a mainline. - Must EXPORT/IMPORT variables for communications..bp Scalar (may EXPORT) ~~~~~~[EXT] type var Constant (may EXPORT) ~~~~~~~~[EXPORT] PROC var;local scalars (BYTE, INT, WORD);local REAL;local DATA;local EXT;local OWN  - may define arrays, retain valueBEGIN[RETURN]END[EXPORT] FUNC type varARG type var;local scalars (BYTE, INT, WORD);local REAL;local DATA;local Eo type WORD    x:+  x@+ (x+1)@+:- convert to INT        @- pointer to type INT     x:-  x@- (x+1)@-:. convert to REAL       @. pointer to type REAL    x:.  x@. (x+1)@. Include LIBRARY Functions ~~~~~~~~~~~~~~~~~~~~~~~~~ A. GENERAL ~~~~~~~~~~reaArray (may EXPORT) ~~~~~[EXT] type var [word1[,word2,...,word8]] [AT $xxxx]               [col,row]           (strings length+1 for $00,                                   no boundary checking,                                   reference without []  high  ...CHOOSE expr (not REAL)    CHOOSE   NOTE: Default type is byte (constants'A'                       expr1          0 to 255). For type word use var:<.  ...                       ...'B'                       expr2  ...                        16 bit checksum, sum of bytes mod 65536EXIT [output arg list]          exit to caller of loadFILL #from,count[,fillerbyte]   initialize area of memory     fillerbyte = $00 to $ff, default = $00word=MAX(word1,word2,...)       returns largest word     [1,2] [2,2] [3,2] [0,3] [1,3] [2,3] [3,3] [0,4] [1,4]                     [2,4] [3,4]        array[col,row] Command Arguments ~~~~~~~~~~~~~~~~~      NCARG     = 0-n, number of arguments      CARG[0]   = command      CARG[1-n] = operands.bp = off, non-0 = on. Used with L optionSTDIN       -  default input deviceSTDOUT      -  default output deviceM[word]     -  access any byteCR & NL     -  new line characterDIOERR      -  0=normal,1=diskfull,2=read error,3=write errorIOERROR     -  Cper case B. SCREEN ~~~~~~~~~byte=CURCOL                     get column position 0-39byte=CURLINE                    get line position 0-24CURSET colbyte,linebyte         set cursor positionbyte=EDLINE(#display string[,limit][,mode][,#colbyte])?              ; conditional compilation end;global scalars (BYTE, INT, WORD);global arrays;global REAL;global DATA;global EXTEXT ASM PROC/FUNC var AT $xxx ; define machine language routine; JSR address,A-reg,X-reg,Y-reg,flag-regINCLUDE LIBRARYNO REAL, x % y gives remainder of x/y<< Left  shift  NO REAL  x << #bits  BYTE=0-8>> Right shift  NO REAL  x >> #bits  WORD=0-16#  Adrress               #x:< low byte              x:<:> high byte             x:>:+ convert to WORD       @+ pointer tnge keys (ignore)              3  $08  if no colbyte cursor at start of string (end of string)     colbyte = if mode = $08, set cursor to this column     byte = terminator entered, TESTKEY valuesFKEYGET 1-8,#string             get function key value      CON [type] var = value (like EQU, type BYTE if <$100, no REAL-use DATA)                                        type INT  if negative                                        else WORD      DATA type var [] = #, #,                         #, # XT;local OWNBEGINRETURN expr        ;  requiredENDBEGINvar=exprNOTHINGIF expr  ...ELSE [IF expr]  ...WHILE expr  ...  [BREAK] - get out of loop  [NEXT]  - jump back to while.bpREPEAT  ...  [BREAK]  [NEXT]UNTIL exprFOR word = low TOl=ABS(real)                absolute value of realABORT [output arg list]       error stop pgmbyte=ALPHA(byte)              true=alpha, false=not alpha a-z A-Z not blankBLKMOV #from,#to,count        copy block of memoryword=CHKSUM(#start,size)    gives address)      - max of 8 subscripts      - always use word bytes for subscripts      - array elements with the first subscript will be adjacent in memory        array[4,5] = [0,0] [1,0] [2,0] [3,0] [0,1] [1,1] [2,1] [3,1] [0,2]                	 ...ELSE                      ELSE  ...                       ...REFUGE 3    -  system abend routine, must be executed before abendREFUGE 0-2  -  goto labels, must be executed before escaped toESCAPE 0-2  -  gotoLIST [#]    -  omitted = reverse, 0 
 valueword=MIN(word1,word2,...)       returns smallest word valuebyte=NUMERIC(char)              returns true if numeric, else falseword=RANDOM [(wordseed)]        return ramdon word value 1-65535byte=TOUPPER(byte)              convert byte to up Statements ~~~~~~~~~~PROGRAM var [OWN] [EXPORT]OVERLAY var [EXPORT] ; OWN is implied; comments?*             ; give following message if V= not on COMPILE commandmessage?              ; end message?C or A or CA  ; conditional compilation start.nf.1h t.hd.cC64 PROMAL V2.1 Language Documentation NotesLast Updated: 01/25/88.ce.eh General ~~~~~~~- Recursive up to 40 times until STACK ERROR.- Compiled memory consist of all scalar first, all arrays, all REAL,  all DATA, all code.  In RY.S SAVE "@0:PROMAL",8                       COMPILE.C    COMPERRMSG.T                                          EXECUTIVE.C  PROSYS.S                                          DATE.C       SETTIME.C Debugging ~~~~~~~~~A. Abend location:   RUNTIMFile Names: 2-11 characters, prefix "1:" = drive 1 (0=default) ~~~~~~~~~~  .C  command/compiled      .R  relative          .F  DOCFOR formatted file  .E  export                .K  key for relative  .X  ASSEM machine code  .S  source                .edirecting STDIN and STDOUT.- On EXT byte PROC and FUNC, argument count checking is NOT done.  Unpredictable system abends occur if not the same.  Arguments read  last to first.- Values which are < 256 evaluate to characters and values >255 evaluateiables:   - Compiled memory consist of all scalar first, all arrays, all REAL,     all DATA, all code.  In that order.   - MAP command to get start address of shared variables      "(VARS:vsadr-veadr)" and see end of COMPILE or execute "SIZE file.c"~~~~~~~    $#  = hex value; \\xx = any hex code within a string    ' ' = constants, no $00 at end    " " = strings,  has $00 at end    variable names may be upto 31 characters long  bytes   type   values  ~~~~~   ~~~~   ~~~~~~~~~~~~~~~~~~~~~~~~~~nclude file.- May use WS CL instead of WS CLEAR.- May put cursor and color characters directly in the source using the editor.- To dispay the date in MM/DD/YY format:  output "#i/#i/#i#c",date[1],date[0],date[2]- Shifting x >> 10 equals x/1024; shif~~~~~~~  COMPILE [source] [O=objectfile] [L[=listfile]] [B[=SOLF]] [V=c/a]                               Default (sum = $10 or 16)  c=commodore  S=symbol table                $A 10                     a=apple  O=object buffer               $1  1 (ds: 1=sign, 8=exp, 39= mantissa                          normalized 1.0-2.0,                          exp biased $7F (exp >= $7F means positive exp)                          sign 0=positive, 1=negative Export/Import ~~~~~~~~~~~~~ - PROGRAM name OW~~~~~~~~~~~~~~~~~~~~~~~~            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ LOAD "PROMAL",8                        Copy the following files: POKE 3554,128 [$DE2] disables dyno       PROMAL       [BOOT] POKE 3555,0   [$DE3] turns off dyno      EDIT.C       LIBRAit outputs to .L file or .X file if .L file does   not exist. Devices: may be used where ever a file is used. ~~~~~~~  S  screen     P  printer     N  null      W  workspace  K  keyboard   T  telephone   L  library      (dioerr=2 if overflow) ed. - May use job file (name.J) to initialize loads or   use bootstrap program which executes LOADs or   UNLOAD and GET name before executing the program which uses it. Overlay ~~~~~~~ - OVERLAY name [EXPORT] ; OWN is implied - Same as PROGRAM that order.- GENMASTER to create independent programs.- Promal assigns file channels low to high.- Maximum of 6 programs/overlays may be loaded at one time.- All memory address are on page boundaries $xx00 (multiples of 256).- "<" and ">" used for rE ERROR: xx at $eadr   - MAP command to get starting address of program "AT $sadr".   - Calculate relative address by radr = eadr - sadr.   - Use listing to find address of statement.  Do not include     variable or DATA statements..bpB. Locate varL  listing           .A  ASSEM source code  .T  text                  .X  xref              .M  ASSEM macro code  .D  data                  ,P  program  .J  job                   ,U  user                            ,S  sequential.bp Data Types ~~~  to an address of a string in PUT and OUTPUT type commands.- File handles point to the file name.- Open up to 3 files, 1 for write or append + 2 for read + STDIN & STDOUT- Dyno on takes 1 input file.- To unload all programs use NLT=2 from PROSYS.S i     to get size of scalar data "GLOB VARS $____,$scalar.size"   - Global scalar (BYTE,INT,WORD):        ABS ADR = vsadr + listing.relative.adr   - Global shared (arrays,REAL):        ABS ADR = vsadr + listing.relative.adr + scalar.size Compile ~~~~~~~~~~~~~~~~~~~~~~~~    1     BYTE   0-255,true,false,string arrays upto 254 characters    2     WORD   0-65535,addresses    2     INT    -32,768 to 32,767    6     REAL   1.E-37 to 1.E+37,1.1,1.,.4 (11 significant digits)                 48 bit	ting x << 10 equals x*1024.- Up to 11 characters used for program names on PROGRAM or OVERLAY stmts.- For byte variables, don't use signed numbers.  Use hex instead (-1 => $FF). Turn off DYNO within PROMAL            Create a Working PROMAL Disk ~~~
on't change)  L=literals/strings            $3  3  F=forward references (ext)    $2  2                                ~~ ~~                      Total =  $10 16 available memory xref ~~~~  XREF source [output] [V=a/c]  If output omitted then N EXPORT - Creates name.E file to be included by any program which uses it.   INCLUDE name.E - The export program must be loaded before the programs which use it. - Whenever an export program is changed, all programs which use it   MUST be re-compilA I                PROMAL 2.1E DOCSPD2A                                                                                       PRONOTES1.T         7    PRONOTES2.T         &                                                                                                                                                                                                 KKKKKKKKKKKKKKKKK.nf.1h t.hd.cC64 PROMAL V2.1 Language Documentation Notes.ce.eh D. CONVERSIONS ~~~~~~~~~~~~~~INTSTR int,#tostring[,base[,minwidth[,padchar]]]   *** INT -> STRING ***     int = number to convert     base = base, default is base 10     minwid tostring size must be limit+1word=OPEN(filename[,mode,[,nocheck[,type]]])     open up to 3 files, 1 for write or append + 2 for read + STDIN & STDOUT     if dyno on then 1 read file taken up.     word = 0 if error (see IOERROR pp 3-77) else pointers ~~~~~~~~~~~~~~~~~~~~~~~CLSALL                          close all opened filesbyte=GETTST(ioflag)             test T device send/receive status     byte = true if ready, else false              See Appendix F.            test input means char hasAL(#string,#toreal)              *** STRING -> REAL ***     byte = 0 if not converted, else index to 1st non-real symbol                                           *** STRING -> INT/WORD ***byte=STRVAL(#string,#to.word.or.int[,base[,maxwidth]])     bs non-PROMAL file, else false     type = 'P' for PRG, 'S' for SEQ default, 'U' for USR        read directory        directory=OPEN("1:$",'r',true)                              if GETBLKF(directory,#buffer,256)        open error channel    errorchan      byte 2 machine ($01=C64, $02=Apple II, $03=IBM PC Jr., $04=IBM PC)word=INLIST(#search.for.string,ptr.list.end[,fold[,limit[,safty]]])     search backwards through a linked list of strings (see pp. 4-26)     word = 0 if not found, else is the ad default ' ' E. DISK & FILE I/O ~~~~~~~~~~~~~~~~~~CLOSE file                    close a fileint=DIR(pattern[,mode true,false,file])     check disk directory     pattern = *,?,filename     mode = true (default) display, false no display, file to+LENSTR(chan)+2)@<                              if GETBLKF(chan,#buffer,256)                              PUTBLKF chan,#buffer,LENSTR(buffer)        open PRG file         prgfile=OPEN("promal",'r',true,'P')OUTPUTF file,formatstring[,item1,item2,... e loop)     ptr.list.end --> next available byte     $5000            word, address of last string entry                       |                        --> the last string entry     NOTE: good to          word, address of previous string entry     byte from device     byte=false if EOF, else true     char=device charbyte=GETLF(file,#tostring[,limit])  NOTE: Only reads upto 128 even if limit     byte=false if EOF, else true         is set greater.     limit = 80 default for C-64 (1-128)    le   *** DISK ***     byte = 0 if ok, else IOERROR valuebyte=ZAPFILE(filename[,wildflag]) delete a file  *** DISK ***     byte = 0 if ok else IOERROR value     wildflag = true if '*' or '?' allowed in filename, else false.bp Include PROSYS routineth = minimum width of tostring     padchar = defaults to ' 'REALSTR real,#tostring,width[,decimal]      *** REAL -> STRING ***     width = 3 to 12 if decimal, 7-16 if scientific, omit=scientific     decimal < width - 1, omit = scientificbyte=STRRE to file descriptor        1-n  = filename string        word = ?        byte = channel number     filename = string name or any device as string like "P" for printer     mode = 'r' read default, 'w' write, 'a' append, 'b' both     nocheck = true i been received            test output means transmitter is empty, last char sent     ioflag = 0 to test input status, 1 to test output statusword=GETVER                     returns PROMAL version code     word =byte 1 version ($21=Version 2.1)     yte = 0 if not converted, else index to 1st non-int/word symbol     base = 10 default     maxwidth = 255 defaultWORDSTR word,#tostring[,base[,minwidth[,padchar]]]  *** WORD -> STRING ***     base = default 10     ninwidth = default 0     padchar ==OPEN("%",'b',true)                              if GETLF(errorchan,#buffer)                              PUTBLKF errorchan,#buffer,LENSTR(buffer)        open any channel      chan=OPEN("#",'b',true)                              bytechannumber=(chandress of the matched string     ptr.list.end = address of the address of the last string entry     fold = true if lower=upper case, else false     limit = max length of string to match on     safty = 8192 by default, max number tries (prevent infinit	 output to     int = number of matches, < 0 means error ABS(int)=IOERRORword=GETBLKF(file,#start,maxsize)     continuous block read, only EOF recognized     word = number bytes actually read     sets byte DIOERRbyte=GETCF(file,#char)          get
]    formatted output                                               SEE OUTPUTPUTF file,item1,item2,...       output strings or bytesPUTBLKF file,#start,size        output block of data     DIOERR is setbyte=RENAME(old,new)            rename a fi       have APPENDLIST   |                INSERTLIST    --> previous string entry                DELETELIST        word, address of first string entry                                   |                                    --> first string entry          filename = string with exact match, upper/lower case not same.     if loadaddr omitted, will take it from the first 2 bytes of the file.     memory pointers are not changed.PROQUIT                         return to BASICREDIRECT #STDIN[,file]                 OLDSIZE = 0          ;   CLEAR WS                 WORG=WLIM - NEWSIZE    ; SET NEW ORIGIN ADDRESS                                        ; NEW WS TOO LARGE FOR AVAIL MEMORY                 IF WORG < LOFREE OR WORG >= HIMEM           ame[,bitflags]         load PROMAL programs and overlaysIF LDERR <> 0  EXIT "Load error (#i), see pp. 3-54",LDERR     pagname = string program name (.C not required)     bitflags = LDCHAIN $01 - chain, replace calling pgm                LDPRCLR $02 T,newfile          PUTF STDOUT,"Hello",nl          REDIRECT #STDOUT          close newfile.bp Include REALFUNC.S ~~~~~~~~~~~~~~~~~~real=POWER(real-x,real-y)               real-x to the real-y powerreal=SQRT(real-x)                       square LOSED                 WSIZE=WLIM - WORG      ; SET NEW WS SIZE                 BLKMOV OLDORG,WORG,OLDWSIZE ; RELOCATE CURRENT DATA IN WSRecover EDITor Space for Entire System (destroys only shared variables)maxmemory        OLDWSIZE=WSIZE >> 10 ; Wgm                default $00 - load, execute, return       bitflags may be added together to combine functions       sets LDERR       uses LOFREE - first byte of unused memory                     value changes when modules are loaded.            HOS(real)                          cosin, angle in radiansreal=SIN(real)                          sine, angle in radiansreal=TAN(real)                          tangent, angle in radiansreal=FLOOR(real)                        remove right of decimal  RLDWSIZE      ;    OR                 [WS 0]           ; USE WS 0 TO RE-CLAIM WSBLKMOV OLDORG,WORG,OLDWSIZE ; RELOCATE CURRENT DATA IN WSRecover EDITor Space for Entire System (destroys only shared variables)maxmemory        OLDWSIZE=WSIZE >> 10 ; Wpp. 3-80,81)       OVERLAY - no unloading of programs/overlays.       PROGRAM - attempt to unload programs/overlays to make room.word=MLGET(filename[,loadaddr])  same as LOAD "PGM",8,1 in basic     word = 0 if error, else address of last byte loaded      WEOF=WLIM                 WSIZE=0WS n             OLDSIZE=WEOF - WORG    ; SIZE OF DATA IN WS(includes WS 0)  OLDWORG=WORG                 NEWSIZE=N << 10        ; N * 1024                 IF OLDSIZE > NEWSIZE   ; NEW WS TOO SMALL FOR DATA  $4000                              $0000<KERNAL.S>  call 6502, 6510, or 65C02 machine language routinesJSR [address[,regA[,regX[,regY[,flags]]]]]     See Appendix I.    reg and flags are type byte    flags are the processor status word.bpLOAD pgmn          change default file for stdin, or reset         #STDOUT[,file]         change default file for stdout, or reset         #STDJOB[,file]         change default file for stdjob, or resetexample:  newfile=OPEN("W",'w')          REDIRECT #STDOU        WORG=LOFREE          ;   SET TO ALL AVAIL MEMORY                 HIFREE=WORG            ; RESERVE NEW SPACE FROM PROMAL                 WEOF=WORG + OLDSIZE    ; RESET WS FILE POINTERS                 WPTR=WEOF              ;  SAME AS IF FILE C- unload all pgms before loading                LDRELD  $04 - reload pgm from disk                LDRECLM $08 - reclaim memory on exit (overlays)                LDNOGO  $10 - load pgm but do not execute (get)                LDUNLD  $20 - unload the proot of real-xreal=EXP(real-x)                        e to the real-x powerreal=LOG(real-x)                        ln real-xreal=LOG10(real-x)                      log real-xreal=ATAN(real)                         arctan, angle in radiansreal=CSIZE / 1024                 HIFREE=MEMLIM    ; RE-CLAIM EDITOR SPACE                 HIMEM=MEMLIM                 GVORG=MEMLIM     ; RE-LOCATE SHARED MEMORY EMPTY                 WLIM=MEMLIM      ; RE-LOCATE WS WITH DATA IN FILE                 WS O	IFREE - byte after the last unused byte of memory                     value changes for shared variables.            MEMLIM - maximum HIFREE value.            LOMEM  - maximum LOFREE value.            if LOFREE > HIFREE then no more free space. (See 
with rounding.bp Memory Management ~~~~~~~~~~~~~~~~~WS CLEAR         WPTR=WORG              ; RESET WS FILE POINTERS                 WEOF=WORGWS 0             WORG=WLIM              ; NO WORK SPACE AVAILABLE                 WPTR=WLIM           KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK