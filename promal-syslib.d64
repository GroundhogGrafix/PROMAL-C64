KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK"@0@@0Gr$@07N"h@0NB@@  jFB  00NB  0N@0
r$B@00  "(B@07  @0
r$@Bj@00  "MBj@07  Fj0cB0s(  B0ll0 (h0cB00s(  B00ll0 (l0cB00s(  B00ll0LIST 0; LIBRARY2   02/09/86;            Updated 12/03/86; additions to LIBRARY for PROMAL V2; Temporary work space variablesbyte tempbyteword tempwordint  tempintreal temprealword tempargs[10]byte tempstr[255]; Special C64 Keys (Color & Cur eed = 12con       col40   = 14data byte col48[] = 14, 27, 'M', 0data byte col66[] = 20, 14, 0con       col80   = 18data byte col96[] = 27, 'M', 0con       col132  = 20 ; 15 normallycon cancel   = 15 ; 20 normally con esc      = 27LIST   = $1ccKon home  = 19con down  = 17con left  = 157con up    = 145con right = 29con rvs_on  = 18con rvs_off = 146con del     = 20con noshift = 8con onshift = 9con onlower = 14con onupper = 142con inst    = 148con shiftreturn = 141ext byte border atKK5con bblu = 6con byel = 7con borg = 8con bbro = 9con bltred = 10con bgray1 = 11con bgray2 = 12con bgray3 = 15con bltgrn = 13con bltblu = 14; Testkey valuescon f1 = $85con f2 = $89con f3 = $86con f4 = $8acon f5 = $87con f6 = $8bcon f7 K   B00@00  B00:  B00@000  B00@00  B00.  B0	@00  B0
0   B00A@00  B00M  B0h  DXXFB  NBj  N@0/@0:r$@00N"@0@@0Gr$@07N"h@0/@0:r$@00Non kcyn    = $9fcon kpur    = $9ccon kgrn    = $1econ kblu    = $1fcon kyel    = $9econ krvs_on  = $12con krvs_off = $92con kspace   = $20; Common COEX 80F/T printer codes;   with CARD? +G Interfacecon bell     = 7con linefeed = 10con formfK  (Bl0/  B00/  B0h  >hP0nBB  h$BB0   F  0w&$h$&(R&<3P File=P RFs i
	4	 6Hbp~2DTa* ,  30:r$@00Nsor)con blk = 144con wht = 5con red = 28con cyn = 159con pur = 156con grn = 30con blu = 31con yel = 158con org = 129con bro = 149con ltred = 150con gray1 = 151con gray2 = 152con gray3 = 155con ltgrn = 153con ltblu = 154con clr   = 147cKK 53280ext byte background at 53281ext byte cursorbackground at 647ext byte text at 646; border, background, and text colors; border & background $F0 + color when accessedcon bblk = 0con bwht = 1con bred = 2con bcyn = 3con bpur = 4con bgrn = KK
= $88con f8 = $8ccon kup     = $91con kdown   = $11con kleft   = $9dcon kright  = $1dcon runstop = $03con kreturn = $0dcon kclr    = $93con khome   = $13con kinst   = $94con kdel    = $14con kblk    = $90con kwht    = $05con kred    = $1ccKIMPORT SYSLIB1 ; 2/15/87  EXT PROC openprinter AT $1203  EXT WORD pfile AT $01F0+$0  EXT PROC getdate AT $114E  EXT PROC hexchar AT $10EF  EXT FUNC BYTE charhex AT $1063  EXT FUNC REAL gettime AT $0EB5  EXT PROC openchk AT $0D52  EXT PROC wait A    4    WSYSLIB1       " M  M F hPjP R     jRj    BQ|$ RBlRBl  RBljRBl  BjPBjP": BjPRBl   RBlj   Qh$ QjQF B  $ BB  &?  Bj	&-$BjP"BBlBBBhB	&-$BjP"hNBB~$jNBB$}BBl BBlBBl  BBljBBl  BBl   BBlj   BjPBjPBB@h$BBv$BB0BBPBjPBPBB$Bh$@0d@05CE  EXT PROC resetmemory AT $05A5  EXT PROC ws AT $04FF  EXT PROC free AT $048D  EXT FUNC WORD alloc AT $0408  EXT PROC allocset AT $03AC  EXT PROC putcenter AT $0373  EXT PROC padstr AT $02E6  EXT FUNC BYTE alphanumericstr AT $02BF  EXT FUNC $jPhPBB  $BBBB    BjPBjP""F @0@@0[r$.@0 @FBPB  $YBB  (  BjP"9Fh@&]>hP0&n0 &@0$0 &h@&]F @0/@0:r@0@@0[r@0`@0{r$jhF B  $B  ($hBD4?    RDXXFL@0s@0c@0i@0w@0r$	@&<@0s@0c@0i@0w@0r$=	@&<@0s*	@0s*V	BB&3"	0c*	B>
&N	@	B&6$u	hXBB
  "	0r*	BB&N	@	B&6$	hX"	BB&N	@	B&6$	hX"0c*=
@0s*	 . upperstr AT $00C1  EXT PROC shift AT $0011OC ws AT $04FF  EXT PROC free AT $048D  EXT FUNC WORD alloc AT $0408  EXT PROC allocset AT $03AC  EXT PROC putcenter AT $0373  EXT PROC padstr AT $02E6  EXT FUNC BYTE alphanumericstr AT $02BF  EXT FUNC 		h	&	(	-	-	-F"	t$&<B	$ $0h P B  	$bj j  j  	"Balloc error - not contiguous memory F B $h " B  |$" &h$&0c*
BB    "&0r*Bv&!vB&N	@	v&6$hX"&BB    BjBj    "0r*@0s*GBB0h&"0c*zB(RDv0h&v>
&N	BB
  "0r*BB0&0"B(RDv0h&v>
&N	BB
  BjB
  "*&"&W0&OPEN ERROR:  Illegal access mode character. Illegal file or device name. Device not ready. File not found. File exists. Can't open another file, buffers are full. Disk write protected. Unknown error (#i) FLN*	,.	2 /	-	-	-	-/(FhPBPBBv$BBl BBlBBl  BBljBBl  BBl   BBlj   BjPBjP"F
hPhPBPjj$BBBllPBPBPBBlBBBhB	j&$P"@&<BBB&6&N@@(% 1:% Invalid drive (#h) Fh h  0 PBB0<PBBv$Q 0 P"8F  h$^0&j*y&"l*&"0*&"0*&"0*&"0*&"0T $0D14  EXT FUNC BYTE diskcmd AT $0C9B  EXT FUNC BYTE diskcheck AT $0C10  EXT BYTE diskmsg [81] AT $019F+$0  EXT FUNC BYTE convert AT $08E4  EXT FUNC REAL FLOOR AT $07FF  EXT PROC sort AT $068D  EXT PROC reverse AT $060E  EXT PROC maxmemory AT $P" F B  $B  &E$hBjP" jF B  $<B  &BB  0 $2hBjP"jFBh$PB&>jP0
n&o N&o N@0@0 $~&o N"gF@0t@0b$B&6jPBB  0 Bj$BjP"BBjh  @0l@0b$B  0 0D$BB(BjPB0PBPP"< > FL"D&4?    x$FD4      $;4      X4?    X<p0&0pjj
p00N@0'$sDX0'@N0P@0$Bhp@0NBjP"B@=
B
ppp<0&0D4      x$DD$BYTE alphanumeric AT $0291  EXT PROC blankline AT $025A  EXT PROC lowerstr AT $0232  EXT FUNC BYTE tolower AT $0217  EXT PROC cleanstr AT $017F  EXT PROC pause AT $013F  EXT FUNC BYTE alphastr AT $010E  EXT FUNC BYTE numericstr AT $00E6  EXT PROCjP"jF@h$B0b(B&6P	BB	~$@0r$0>B	PBnBB@  BBh  @0l$rB &3>hPBB	nBB@  BBh   BB&6&3FB&6N0@lN@hr@0$hN@@&]B&F B$	 	"	h&h(@0y$B  P
B
B&!":
0c*	BB    ":
0r*&
B  P
B
v&!vB&N	@	v&6$#
hX":
BB    Bjh  "0i*
@0s*U
BB&"
0c*g
BB    "
0r*
Bv&vB&N	@	v&6$
hX"
BB    BjBj    "0w*)@0s*
BB&!"&	j  Nl  N0  N0@00
0@R@0$D00xR"5D4A@    $)4      R"5D4B    RD0@00
0@0<RD0@00
0@RD@4A     RB0@000  Bj0@00  Bl0:  B00@000
(("j j  j  	"F@0c$		@h$6			h		P	P@2 PBB$YhP	B		t		$z			B			B	B&0F  *,		/(.F  	jXXconvert: invalid totype ($#h) convert: invalid fromtype ($#h) FN@00*00bj&$P"Q01*F0bj&$P"Q@&<B&N@>&NB0t$zh"~B% 1:% Invalid drive (#h) FN@00*0bj&$P"01*0b types.               byte  = 1 if convert failed, else 0               #from = address of source data type area               #to   = address of target data type area               fromtype = 's' for string               totype     'c' for characte Opens the printer device and sets                                        PFILE to file handle for the printer.                                        Use "CLOSE PFILE" to close the                                        printer file.Any problems, q C. STRING MANIPULATION ----------------------byte=ALPHANUMERICSTR(#string)           Validates string as alpha, numeric,                                        or blank.                                        byte=true if numeric, else false     sort routines.               maxindex = the highest array index number (like 0 - 39, = 39)               sorttype = 'a' or 'A' for ascending (default)                          'd' or 'D' for descending               offset   = 0 to lenstr up to 254                  Convert a byte of memory to its                                        corresponding ASCII hex characters.               #memory = address of a byte of memory to convert               #accii  = address of 2 bytes to store ASCII hex chXAMPLE:  IF ALPHASTR("DKDKSHK")                     PUT "GOOD STRING",NLCLEANSTR #string,option                 Remove leading/trailing blanks               option = 't' trailing    from a string.                        'l' leading                             OF 10.BPUPPERSTR #string                        Convert string to upper case.         EXAMPLE:  UPPERSTR NAME D. CONVERSIONS --------------byte=CHARHEX(#ascii,#tohex)            Convert a ASCII hex character to its               r drive 9               sets string DISKMSG with disk error message         EXAMPLE:  IF DISKCHK('0')                     PUT 'DISK ERROR',NLbyte=DISKCMD(drive,#command)            Send disk commands to 1541, similar               byte = disk rettring as numeric.               byte=true if numeric, else false         EXAMPLE:  IF NUMERICSTR("ABC232S")                     PUT "OK STRING",NLPADSTR #string,option,size,padchar      Add a padding character to a string.               option =                NOTE: 2 ASCII hex characters = 1 hex value                     example "01" --> $01         EXAMPLE:  IF CHARHEX(STRING+I,HEXVAL+J)                     PUT "BAD HEX VALUE",NLbyte=CONVERT(#from,fromtype,#to,totype)        Convert dataSKCMD('0',"N0:DISK01,AB")                     PUT "NEW DISK FAILED",NLOPENCHK                                 Tests IOERROR and displays the                                        corresponding error message.OPENPRINTER                            ter to pad with         EXAMPLE:  PADSTR NAME,'l',15,' 'SORT #stringarray,maxindex,sorttype,offset,limit  Sort a string array                                                  using quicksort method.               This sort is much faster than mostr or byte                          'i' for int                          'w' for word                          'r' for real         EXAMPLE:  IF CONVERT(STRING,'s',#WORDVAL,'w')                     PUT "STRING IS INVALID",NLHEXCHAR #memory,#ascii uestions, or comments are welcomed.  Please addressthem to "CRAIG MC" on Quantum Link or write:               Craig McDowell               80 E. Tulane Rd.               Columbus, Ohio  43202error message.OPENPRINTER                                 EXAMPLE:  IF NOT ALPHANUMERICSTR("ABDC23LW23D")                     PUT "BAD INPUT",NLbyte=ALPHASTR(#string)                  Validates string as alpha or blanks.                                        byte=true if alpha, else false         Ebytes               limit    = 0 to 254, end of string will terminate compare         EXAMPLE:  SORT #ARRAY,99,'a',0,254 ; SORT ENTIRE STRING                   SORT #ARRAY,99,'d',4,10  ; SORT AT COLUMN 4 FOR LENGTH                                   aracters         EXAMPLE:  HEXCHAR #HEXVAL,STRINGVAL E. DISK & FILE I/O ------------------byte=DISKCHK(drive)                     Returns disk error message.               byte = disk return code               drive = '0' for drive 8 or '1' fo        'b' both leading and trailing blanks are removed         EXAMPLE:  CLEANSTR NAME,'t'LOWERSTR #string                        Convert string to lower case.         EXAMPLE:  LOWERSTR NAMEbyte=NUMERICSTR(#string)                Validates s	                        corresponding hex byte value.               byte = 1 if invalid ASCII hex character, else 0               #ascii = address any valid hex characters like "0A"               #tohex = address of byte area to store hex value $0A 
urn code  to the PROMAL DISKCMD command.               drive = '0' for drive 8, '1' for drive 9               #command = 1541 disk drive command string (use uppercase)               sets string DISKMSG with disk error message         EXAMPLE:  IF DI'l' pad on the left side of the string                        'r' pad on the right side of the string                         0  no padding               size = the total size of the string after padding               padchar = ' ' or any byte charac.NF.NJ.RM 80.OH//C64 PROMAL V2.1 SYSLIB1.E (V1.0) Documentation//.EH//C64 PROMAL V2.1 SYSLIB1.E (V1.0) Documentation//.OF//-#-//.EF//-#-// General Notes: ------------- 1. No argument checking is done at compile time due to exporting.    Missi  value ranges from 0 to 6359.9               #string = address of 14 byte string "hh:mm:ss.h pm"         EXAMPLE:  BYTE CURTIME[14]                   REAL SECONDS                   SECONDS=GETTIME(CURTIME)real=FLOOR(val)                         A')WAIT secs                               Wait for a number of seconds.         EXAMPLE:  WAIT 5.BPWS Ksize                                Alter workspace allocation, similar         Ksize = 'c' clear workspace    to PROMAL WS command.        d FREE.               word = address of allocated memory               size = the amount of memory to allocate in bytes, does NOT                      have to be a multiple of 256         EXAMPLE:  ADDR=ALLOC(LENSTR(TEMP)+1)ALLOCSET ownoption,resf allocated memory to free in bytes, does                      NOT have to be a multiple of 256.                      NOTE:  If size is too big, ALL allocated memory                             will be freed.  There is no error.         EXAMPLE:  FR is allocated to                            the workspace.  There is no error.                         2) If the new size of the ws is too small to                            contain the data already stored, then the ws                            wil        kept from ALLOC access for testing out-of-memory         EXAMPLE:  ALLOCSET 'y',0byte=ALPHANUMERIC(char)                 Validates char as alpha, numeric,                                        or blank.                                                          non-OWNed programs may be loaded                                        since the shared memory is moved                                        as well.  You must use RESETMEMORY                                        before retu                          Pause until space or return key hit.               #message = address of message to display (no new line) or                          0 for no message.         EXAMPLE:  PAUSE "HIT RETURN"                   PUT NL         st 9 bytes long         EXAMPLE:  BYTE TODAY[9]                   GETDATE TODAYreal=GETTIME(#string)                   Get the time set by TIMESET command.               real = number of seconds in the day, output "#7.1r",real                                         as it was before MAXMEMORY was                                        executed.byte=TOLOWER(char)                      Convert byte to lower case.               byte = lower case value of char         EXAMPLE:  LOWSTR=TOLOWER('t by 1                                        so that carg[0]=carg[1]                                                carg[1]=carg[2]                                                etc.                                        and decrement ncarg by 1.ng arguments may result in system abends or unpredictable     results.   Functions: --------- A. GENERAL ----------word=ALLOC(size)                        Dynamically allocate free memory.                                        See ALLOCSET anReturn greatest integer of real val.         EXAMPLE:  ROUNDNUM=FLOOR(45.34)FREE size                               Dynamically free allocated memory.                                        See ALLOCSET and ALLOC.               size = the amount o          0  will empty workspace (i.e. no workspace)                  else any value in K bytes (that is Ksize * 1024)                  NOTE:  1) If more memory is requested than is available,                            then all available free memoryerved             Setup ALLOC/FREE environment.                                        See ALLOC and FREE.               ownoption = 'y' if compiled with OWN, else 'n'               reserved  = any amount which is a multiple of 256                   EE 32000MAXMEMORY                               Sets PROMAL environment to include                                        the editor space.  Must be invoked                                        by an OWNed program but after that                  l be cleared.  There is no error.         EXAMPLE:  WS 10     ; 10 KILOBYTES B. SCREEN ---------BLANKLINE line                          To clear a line on the screen.               line = 0 to 24         EXAMPLE:  BLANKLINE 4PAUSE #message	    byte=true if numeric, else false         EXAMPLE:  IF NOT ALPHANUMERIC('X')                     PUT "BAD CHARACTER",NLGETDATE #string                         Returns PROMAL system date mm/dd/yy.               #string = address of string at lea
rning to the executive                                        or use the RESET command.RESETMEMORY                             Warm init of PROMAL system after                                        MAXMEMORY used.  System appears                             PAUSE 0PUTCENTER row,#string                   Display a string centered on the               row = 0 to 24            screen.         EXAMPLE:  PUTCENTER 1,"SCREEN ONE INPUT"SHIFT          shift carg values        Move carg values lefA 
h                        
PROMAL-SYSLIBPS2A                                                                                       SYSLIB1_DOC.T         *    SYSLIB1.S         B    SYSLIB1.E            SYSLIB1.C            LIBRARY2.S                                                                                                          KKKKKKKKKKKKKKKKKprogram syslib1 own export; Last Updated: 02/15/87; FUNCTIONS:; shift upperstr numericstr alphastr; pause cleanstr tolower lowerstr; blankline alphanumeric alphanumericstr; padstr putcenter pager ws openprinter; gettime getdate wait openchk convirst  i=lenstr(string)-1  while m[string+i]=' ' and i>-1    i=i-1  m[string+i+1]=0if cmd='l' or cmd='b'  ; remove leading blanks next  while m[string]=' '    j=1    i=0    while m[string+i]      m[string+i]=m[string+j]      i=i+1      j=j+1roc putcenter ; 0-24,string; output string centered on screen line (0-24)arg byte row   ; 0-24arg word linebyte colbegincol=lenstr(line)col=20-(col/2)  ; half of 40if col<0 or col>20  col=0curset col,rowput lineend;  To allow dynamic allocarg[1] ...word iword jbeginj=0i=1m[#tempword]=m[carg]m[#tempword+1]=m[carg+1]while i<=ncarg  m[carg+j*2]=((carg+i*2)@+):<  m[carg+j*2+1]=((carg+i*2)@+):>  j=j+1  i=i+1i=i-1m[carg+i*2]=tempword:<m[carg+i*2+1]=tempword:>if ncarg<>0  ncarg=n  m[x]=tolower(m[x])  x=x+1endexport proc blankline ; 0-24; clear line on screen (0-24)arg byte lineword ibegincurset 0,linefor i=0 to 38  put ' 'if line<>24  put ' 'curset 0,lineendexport func byte alphanumeric ;(byte); returns 1 if b (get max memory available).;  reserved = word reserved bytes for;             testing end of memory.;            (MUST BE FACTOR OF 256);  if free size is too large, system;  variables are reset (no error).word aoriglowword anewlowword asavlowwhile m[string]  if not numeric(m[string])    return 0  string=string+1return 1endexport func byte alphastr ;(string)arg word string; returns 1 if string is alpha or blank, else 0beginwhile m[string]  if (not alpha(m[string])) and m[string]<, else return 0arg word stringbeginwhile m[string]  if not alphanumeric(m[string])    return 0  string=string+1return 1endexport proc padstr ; string,code,size,char; pad a string with char of given sizearg word stringarg byte code  ; 'l' pad  wsize=0        ; recover work space  aorighi=hifree  aorighimem=himem  hifree=memlim  ; recover editor space  himem=memlim  gvorg=memlimendexport func word alloc ;(size)arg word size    ; return 0 if errorword returnadrbeginif asavlow<lofree<>$d and hold<>$20  hold=testkeyendexport proc cleanstr ; string,'t/l/b'arg word stringarg byte cmd ; 't'=trailing,'l'=leading,'b'=both; remove leading and/or trailing blanksword iword jbeginif cmd='t' or cmd='b'  ; remove trailing blanks frnif code='r' ; pad on right  for i=length to size    m[string+i]=char  m[string+i]=0if code='l' ; pad on left  movstr string,tempstr  for i=0 to size-length    m[string+i]=char  m[string+i]=0  movstr tempstr,string+lenstr(string)endexport pert; diskcmd diskcheck alloc free reverse; maxmemory resetmemory charhex hexcharinclude libraryinclude library2include prosysexport proc shift; purpose: To move all carg values left;          including the command name.;          carg[0] <- caendexport func byte tolower ;(byte); convert byte to lower casearg byte holdbeginif hold>64 and hold<91   return hold+32return holdendexport proc lowerstr ; string; convert string to lower casearg word stringword xbeginx=stringwhile m[x]tion of free;  memory within the system.;;  allocset 'n'/'y',reserved;  word=alloc(size);     returns 0 if overflow;  free size;;  size = word number of bytes;  'n'  = programs not compiled with own;  'y'  = programs compiled with own;        carg-1endexport proc upperstr ; stringarg word string; convert string to upper casebeginwhile m[string]  m[string]=toupper(m[string])  string=string+1endexport func byte numericstr ; stringarg word string; returns 1 if numeric, else 0beginyte alpha, numeric, or blank, else return 0arg byte holdbeginif (hold>47 and hold<58) or (hold>64 and hold<91) or (hold>96 and hold<123)  return 1return 0endexport func byte alphanumericstr ;(string); returns 1 if string alpha, numeric, or blankword areservedword aorighiword aorighimem export proc allocset ; 'y/n',0  arg  byte type ; 'n'/'y'arg  word reservedbeginareserved=reservedanewlow=lofreeasavlow=lofreeaoriglow=lofreeaorighi=0aorighimem=0if type='y'  wptr=worg  weof=worg 	>' '    return 0  string=string+1return 1endexport proc pause ; string; wait for return or space key, no prompt; optional stringarg word stringbyte holdword ibeginif string<>0  put stringfor i=1 to 10  hold=testkeyhold=testkeywhile hold
 on left side of string;                'r' pad on right side of string;                 0  no paddingarg int  sizearg byte charint lengthword ibeginif code=0 ; no function  returncleanstr string,'b'length=lenstr(string)if size<=length  retu ; larger module loaded  abort "alloc error - not contiguous memory"if size>hifree-areserved-anewlow  return 0  ; out of available memoryreturnadr=anewlowanewlow=anewlow+sizeif anewlow>lofree  ; update lofree  m[#lofree+1]=m[#anewlow+1]+1  asavloc resetmemory; execute at end of pgm only; keep data in wsbeginhifree=savhifree ; reset all pointershimem=savhimemgvorg=himemwlim=himemws savwsizenlt=savnltendexport proc maxmemorybegin; recover editor spacesavhifree=hifreesavhimem=himem     m[array+j*2+1]=tempword:>        i=i+1        j=j-1    until i>j or flag=0    if i<l      af[s]=i      al[s]=l      s=s+1    l=j  until f>=l  if s=0    if stype='d' or stype='D'      reverse array,number    return  s=s-1  f=af[s]  l=orighimem      gvorg=aorighimem else  m[#lofree+1]=m[#anewlow+1]+1  asavlow=lofreeend; PURPOSE:      ;  To perform ws operations reset, clear, and size change.;  To get maxmemory for genmaster, use "gws 0";;  ws Ksize         similar to promalength;;  array = addr word array pointing to strings;  number= word number of entries -1 (0-99=100 entries);  stype = 'a' or 'A' for assending (default) a,b,c;          'd' or 'D' for desending           c,b,a;  offset= start compare within recordtring;  totype     'c' for character;             'i' for int;             'w' for word;             'r' for real;  real=floor(real) ; remove right of decimalexport FUNC REAL FLOOR ; (VAL)  ;RETURN REAL GREATEST INTEGER OF REAL ARGUMENTARG REAL s ws to all available memory - 512 bytesexport proc ws ; Ksize ; works like as promal ws command except 'c' instead of cleararg byte size ; in K bytesword oldadrword oldsizeword newsizebeginif size='c' ; clear workspace  wptr=worg  weof=worg i*2+1]=((array+j*2)@+):>  m[array+j*2]=tempword:<  m[array+j*2+1]=tempword:>  i=i+1  j=j-1endexport proc sort ; array,number,stype,offset,lengtharg word arrayarg word numberarg byte stypearg word offsetarg word lengthword yint  iint  jint RETURN VAL ; KEEP ALL BITS OF MANTEXP=39-EXP   ; # BITS TO CLEAR I=5WHILE EXP >= 8  TEMP[I]=0  EXP=EXP-8  I = I-1TEMP[I]=MASK[EXP:+] AND TEMP[I]BLKMOV TEMP,#NEWVAL,6IF VAL < 0.  IF NEWVAL <> VAL ; NOT AN INTEGER ALREADY?    NEWVAL = NEWVAL - 1f worg<lofree or worg>=himem ; new ws too big  worg=lofree  ; use all avail memoryhifree=worgwptr=worg+oldsize ; save old dataweof=wptrwsize=wlim-worgblkmov oldadr,worg,oldsizeendword savhifreeword savhimembyte savnltbyte savwsizeexport pro>",y+offset,false,length)        j=j-1      flag=0      if i<=j        flag=1        if i<>j          tempword=(array+i*2)@+          m[array+i*2]=((array+j*2)@+):<          m[array+i*2+1]=((array+j*2)@+):>          m[array+j*2]=tempword:<     w=lofreereturn returnadrendexport proc free ; sizearg word sizebeginif size>anewlow  anewlow=0else  anewlow=anewlow-sizeif anewlow<=aoriglow  asavlow=aoriglow  lofree=aoriglow  anewlow=aoriglow  if aorighi<>0    hifree=aorighi    himem=asavnlt=nltsavwsize=wsize/1024hifree=memlimhimem=memlimgvorg=memlim; recover workspacewlim=memlimws savwsizeend; PURPOSE:      ;  To sort a word array pointing to;  strings using the quicksort technique.;;  sort array,number,stype,offset,maxal[s]end; PURPOSE:      ;  To convert any type to another type.;;  byte=convert (#from,fromtype,#to,totype);;  byte = 0 if convert failed;         1 if convert successfull;  #from= addr from type;  #to  = addr to type  ;  fromtype = 's' for sl command ws;  maxmemory        to take editor and workspace;  resetmemory      to restore pointers to orignal logon.;;  size = 'c' clear workspace;          0 empty;          # K byte size in decimal, if too big same as -1;          -1 or $ff set;  maxlen= maximum length to compare within recordword af[16] ; 0-15word al[16] ; 0-15export proc reversearg word arrayarg word numberint  iint  jbegini=0j=numberwhile i<j  tempword=(array+i*2)@+  m[array+i*2]=((array+j*2)@+):<  m[array+VALREAL NEWVALWORD IBYTE EXPOWN BYTE TEMP[6]DATA BYTE MASK[]=$FF,$FE,$FC,$F8,$F0,$E0,$C0,$80BEGINIF ABS(VAL) < 1.0  IF VAL >= 0.    RETURN 0.  RETURN -1.BLKMOV #VAL,TEMP,6EXP=TEMP@< <<1 + (TEMP[1] >= $80) -$7F ; 8 BIT EXPONENTIF EXP >= 39  	 returnif size=0   ; no workspace  worg=wlim  wptr=wlim  weof=wlim  wsize=0  returnoldsize=weof-worg      ; size of data in wsoldadr=worgnewsize=size*1024if oldsize>newsize     ; new ws too small for current data  oldsize=0worg=wlim-newsizei
  sint  fint  lbyte flagbegins=0f=0l=numberwhile 1=1  repeat    y=(array+((l+f)/2)*2)@+    i=f    j=l    repeat        while cmpstr(((array+i*2)@+)+offset,"<",y+offset,false,length)        i=i+1      while cmpstr(((array+j*2)@+)+offset,".RETURN NEWVALENDexport func byte convert ;(fvar,ftype,tvar,ttype)arg word fromvararg byte fromtypearg word tovararg byte totypebyte indexword holdreal hold2own byte string[41]con length = 12con decimal = 0beginif totype<>'s' and totype<var@.,tovar,length,decimal  'c'    hold2=floor(fromvar@.)    realstr hold2,string,length,decimal    index=strval(string,#hold)    m[tovar]=hold:<  'r'    blkmov fromvar,tovar,6  else ; 'i' or 'w'    hold2=floor(fromvar@.)    realstr hold2,strintime+(secs*60)while time<stop  time=(tmed:+<<8 + tlo)endexport proc openchk; PURPOSE:      ;  Check IOERROR after open and display;  an error message.;;  openchk                    ;; EXAMPLES:;  file=open(myfile,r);  if file=0;    openchpe's'  choose totype  's'    movstr fromvar,tovar  'c'    index=strval(fromvar,#hold)    if index<>lenstr(fromvar)      return 0    m[tovar]=hold:<  'r'    index=strreal(fromvar,tovar)    if index<>lenstr(fromvar)      return 0  else ; 'i' ive,"disk command");  byte=diskcheck(drive);;  byte           = 1541 error number;  drive          = '0','1';  "disk command" = disk command to send;                   must be upper case commandexport byte diskmsg[81]export func byte diskcheck   put "Can't open another file, buffers are full."7  put "Disk write protected."else  output "Unknown error (#i)",ioerrorput nlendexport func real gettime ;(#14bytestring) ; PURPOSE:      ;  Get the time in real seconds and;  in string forma index=strreal(string,tovar)    if index<>lenstr(string)      return 0  else ; 'i' or 'w'    m[tovar]=m[fromvar]    m[tovar+1]=0'i'  choose totype  's'    intstr fromvar@-,tovar  'c' ; truncate high order byte    m[tovar]=m[fromvar]  'r'      c64cmd=open("1:%",'b',true)else  abort "Invalid drive (#h)",driveindex=getlf(c64cmd,diskmsg)c64dyno=savedynoINDEX=STRVAL(diskmsg,#I)if i<20  return 0   else  return iENDexport func byte diskcmd ;('0/1',command)arg byte drivearg word comma  in secondsext byte clock at 56331 ; tod clock hrsbeginhour = clockmin = m[#clock-1] sec = m[#clock-2] tenth = m[#clock-3] jiffy=((16 and hour)/16)*10+(15 and hour)if hour and $80  jiffy=(jiffy+12)*120else  if jiffy=12. ; 12am gets 0    jiffbyte    m[tovar]=m[fromvar]  'r'    wordstr fromvar@+,string    index=strreal(string,tovar)    if index<>lenstr(string)      return 0  else ; 'i' or 'w'    m[tovar]=m[fromvar]    m[tovar+1]=m[fromvar+1]'r'  choose totype  's'    realstr from; PURPOSE:      ;  To wait n number of seconds.;;  wait secs;;  secs = number of seconds to wait. ext byte tmed at $a1ext byte tlo at $a2export proc wait ; secsarg word secsint  timeint  stopbegintmed=0tlo=0time=(tmed:+<<8 + tlo)stop=>'c' and totype<>'i' and totype<>'w' and totype<>'r'  abort "convert: invalid totype ($#h)",totypeif fromtype<>'s' and fromtype<>'c' and fromtype<>'i' and fromtype<>'w' and fromtype<>'r'  abort "convert: invalid fromtype ($#h)",fromtypechoose fromtyg,length,decimal    index=strval(string,#hold)    m[tovar]=hold:<    m[tovar+1]=hold:>else  nothingreturn 1end; PURPOSE:      ;  To send a disk command to the disk.;  To read error channel, set diskmsg;  to error message.;;  byte=diskcmd(drk;    exit "File=#s",myfile beginif ioerror=0  returnput nl,"OPEN ERROR: "choose ioerror1  put "Illegal access mode character."2  put "Illegal file or device name."3  put "Device not ready."4  put "File not found."5  put "File exists."6or 'w'    index=strval(fromvar,tovar)    if index<>lenstr(fromvar)      return 0'c' ; value of type c  choose totype  's'    hold=m[fromvar]    wordstr hold,tovar  'c'    m[tovar]=m[fromvar]  'r'    hold=m[fromvar]    wordstr hold,string   ;('0/1')  ;CHECK DISK ERROR CHANNEL  ;RETURNS 00 IF OK, ELSE  ;C-64 ERROR NUMBER  ;diskmsg HOLDS TEXT OF ERROR MESSAGEarg byte drivebyte savedynoword c64cmdBYTE INDEXword ibeginsavedyno=c64dynochoose drive'0'  c64cmd=open("%",'b',true)'1't hhmmss.t[a/p]m;;  jiffy=gettime(string)      ;;  jiffy = real #7.1r format;          min=0.0 max=6359.9 seconds;  string= 14 byte or greater string;          hh:mm:ss.h amarg word string byte hourbyte minbyte secbyte tenthreal jiffy ; time	intstr fromvar@-,string    index=strreal(string,tovar)    if index<>lenstr(string)      return 0  else ; 'i' or 'w'    m[tovar]=m[fromvar]    m[tovar+1]=m[fromvar+1]'w'  choose totype  's'    wordstr fromvar@+,tovar  'c' ; truncate high order 
ndbyte savedynoword c64cmdbeginsavedyno=c64dynochoose drive'0'  c64cmd=open("%",'b',true)'1'  c64cmd=open("1:%",'b',true)else  abort "Invalid drive (#h)",driveputblkf c64cmd,command,lenstr(command)c64dyno=savedynoreturn diskcheck(drive)endy=0.  else    jiffy=jiffy*120.jiffy=jiffy+(((240 and min)/16)*10+(15 and min))*60jiffy=jiffy+((240 and sec)/16)*10+(15 and sec)jiffy=jiffy+(tenth/10.)m[string] = (16 and hour)/16+48 m[string+1] = (15 and hour)+48 m[string+2] = ':'     m[string+3',2,' 'tempbyte=convert(#date[0],'c',sysdate+3,'s')padstr sysdate+3,'l',2,' 'tempbyte=convert(#date[2],'c',sysdate+6,'s')padstr sysdate+6,'l',2,' 'm[sysdate+2]='/'m[sysdate+5]='/'m[sysdate+8]=0for i=0 to 7  if m[sysdate+i]=0    m[sysdate+i]=' 'Kng+12] = 'M'm[string+13] = 0return jiffyend; PURPOSE:      ;  To convert a hex character string;  to a hex number. (C'A0' <-> X'A0');  Charhex must be upper case.;  Vise versa.;;  byte=charhex(#hexchar,#hexbyte);       hexchar(#byte,#hexchar)KKing]hex2=m[string+1]if hex1>47 and hex1<58  hex1=hex1-48 else if hex1>64 and hex1<71  hex1=hex1-55else  return 0if hex2>47 and hex2<58  hex2=hex2-48 else if hex2>64 and hex2<71  hex2=hex2-55else  return 0hex1=hex1<<4m[tohex]=hex1+hex2retuKK+55if hex2<10  m[string+1]=hex2+48else  m[string+1]=hex2+55endexport proc getdate ; date 9 chars; returns system date mm/dd/yyarg word sysdate ; string of at least 9 bytesword ibegintempbyte=convert(#date[1],'c',sysdate,'s')padstr sysdate,'lK] = (240 and min)/16+48 m[string+4] = (15 and min)+48m[string+5] = ':'     m[string+6] = (240 and sec)/16+48m[string+7] = (15 and sec)+48m[string+8] = '.'     m[string+9] = tenth+48m[string+10] = ' 'm[string+11] = 65+(hour>127)*15 ; A or Pm[stri endexport word pfileexport proc openprinterbeginpfile=open("P",'w')if pfile=0  openchk  abort "File=P"endbeginend/dd/yyarg word sysdate ; string of at least 9 bytesword ibegintempbyte=convert(#date[1],'c',sysdate,'s')padstr sysdate,'lK;;  hexbyte = binary byte;  hexchars= 2 ascii hex charaters;            (1 hexbyte = 2 hexchars);export func byte charhex ;(string,#hex); convert ASCII hex character to hex valuearg word stringarg word tohexbyte hex1byte hex2beginhex1=m[strKK	rn 1endexport proc hexchar ; #hex,string; convert hex value to ASCII 2 byte charatersarg word fromhexarg word stringbyte hex1byte hex2beginhex1=(m[fromhex] and $f0)>>4hex2=m[fromhex] and $0fif hex1<10  m[string]=hex1+48else  m[string]=hex1KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK